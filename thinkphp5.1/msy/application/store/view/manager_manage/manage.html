{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="store_css/main.css">{/block}
{block name="content"}
<!--省市区-->
<section id="areaLayer" class="express-area-box" style="display:none;">
	<header>
		<h3>选择地区</h3>
		<a id="backUp" class="back" href="javascript:void(0)" title="返回" style="display: none;"></a>
		<a id="closeArea" class="close" href="javascript:void(0)" title="关闭"></a>
	</header>
	<article id="areaBox">
		<ul id="areaList" class="area-list"></ul>
	</article>
</section> 
<div id="areaMask" class="mask"></div>
<!--新增线上店铺员工账号-->
<section id="storeEmployeeSection" style="display:none;">
	<form class="storeEmployeeForm">
		<div class="account-field">
			<span class="content-label">姓名</span>
			<input type="text" class="" placeholder="姓名" name="name">
		</div>
		<div class="account-field">
			<span class="content-label">手机号码</span>
			<input type="tel" class="" placeholder="手机号码" name="mobile_phone">
		</div>
        {include file='public/permission_tpl' /}
	</form>
</section>
<!--新增门店员工账号-->
<section id="shopEmployeeSection" style="display:none;">
    <form class="storeEmployeeForm">
        <div class="account-field">
            <span class="content-label">姓名</span>
            <input type="text" class="" placeholder="姓名" name="name">
        </div>
        <div class="account-field">
            <span class="content-label">手机号码</span>
            <input type="tel" class="" placeholder="手机号码" name="mobile_phone">
        </div>
        <div class="account-field">
            <span class="content-label">所属门店</span>
            <select name="">
                <option value="1">门店1</option>
                <option value="2">门店2</option>
            </select>
        </div>
        {include file='public/permission_tpl' /}
    </form>
</section>
<article class="f24">
	<div class="top_header">
		{include file='public/switch_manager_store' /}
		<section class="specific_type store_deploy_nav">
			<div class="columns_flex f20 l-r-sides store_deploy_bar">
				<a href="javascript:void(0);" class="current" data-type="online">线上店铺店长管理</a>
				<a href="javascript:void(0);" data-type="o2o">020门店店长管理</a>
			</div>
		</section>
		<section class=" ">
			<div class="columns_flex f20 l-r-sides top_empy_nav">
				<a href="javascript:void(0);" class="current" data-type="0">店铺运营员工账号管理</a>
				<a href="javascript:void(0);" data-type="1">设定商品退换收货人地址手机号码</a>
			</div>
			<div class="columns_flex f20 l-r-sides top_empy_nav hide">
                <a href="javascript:void(0);" class="current" data-type="2">门店员工账号</a>
                <a href="javascript:void(0);" data-type="3">门店经营地址</a>
                <a href="javascript:void(0);" data-type="4">门店收货人地址手机号码</a>
            </div>
		</section>
	</div>
	<section class="f24 account-content-wrapper">
		<div class="content-top content-mg-top">
			<div class="content_main">
				<!--店铺员工列表-->
				<section class="section_content" id="storeEmployeeList">
					<form class="">
						<div class="search_module_bar">
							<input type="button" class="search_btn left"/>
							<input type="text" class="search_text left" placeholder="输入姓名/岗位/手机号搜索账号"/>
						</div>
						<p class="emp_account_tipc">线上店铺运营员工账号</p>
						<ul class="list">
							<li class="no-data"><span>暂无数据</span></li>
						</ul>
						<a href="javascript:void(0);" class="add_online_account foot-btn">新增线上店铺员工账号</a>
					</form>
				</section>
				<!--退换货人地址手机-->
				<section class="section_content" id="consigneeInfo">
					<form class="consignee_info_form">
						<p class="emp_account_tipc">设定店铺的收货人地址手机号码（*用于顾客退换货时对接）</p>
						<div class="input_item">
							<input class="input-filed" type="text" name="name" value="" placeholder="收货人姓名">
						</div>
						<div>
							<input class="input-filed" type="tel" name="mobile_phone" value="" placeholder="收货人手机号码">
						</div>
						<div class="express-area area-box">
							<a id="expressArea" href="javascript:void(0)" class="f24 form-group box-flex">
								<label class="form-label">所在地区：</label>
								<div class="area_address">省 &gt; 市 &gt; 区/县</div>
								<input type="hidden" value="" class="area-address-name" data-key="" name="provinces">
							</a>
						</div>
						<div>
							<input class="input-filed" type="text" name="detail_name" value="" placeholder="详细地址">
						</div>
					</form>
				</section>
				<!--门店员工列表-->
				<section class="section_content" id="shopEmployeeList">
					<form class="">
						<div class="search_module_bar">
							<input type="button" class="search_btn left"/>
							<input type="text" class="search_text left" placeholder="输入姓名/门店/手机号搜索账号"/>
						</div>
						<p class="emp_account_tipc">门店运营员工账号</p>
						<ul class="list">
							<li class="no-data"><span>暂无数据</span></li>
						</ul>
						<a href="javascript:void(0);" class="add_store_account foot-btn">新增门店员工账号</a>
					</form>
				</section>
				<!--门店经营地址-->
				<section class="section_content" id="shopAddressList">
					<ul class="list">
						<li>
							<img src="" alt="" class="left">
							<div>
								<div>
									<span>莫某门店</span>
								</div>
								<div>地址：<sapn>广东</sapn></div>
								<div>固话：<span>020-45646455</span></div>
								<div>手机：<span>13825545678</span></div>
								<div>
									<i></i>
									距离<span>500</span>km
								</div>
							</div>
						</li>
					</ul>
				</section>
				<!--门店收货人地址手机-->
				<section class="section_content" id="shopConsigneeList">
					<ul class="list">
						<li>
							<img src="" alt="" class="left">
							<div>
								<div>
									<span>莫某门店</span>
								</div>
								<div>收货人地址：<sapn>广东</sapn></div>
								<div>收货人姓名：<sapn>李四</sapn></div>
								<div>收货人手机号码：<span>13825545678</span></div>
							</div>
						</li>
					</ul>
				</section>
			</div>
		</div>
	</section>
</article>
{/block}
{block name="common"}{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript">
	$(function(){
		//初始化
		$('.content_main .section_content').eq(0).show();
		
		//新增线上店铺员工账号
		var storeEmployeeSection=$('#storeEmployeeSection').html();
		$('body').on('click','.add_online_account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['新增线上店铺员工账号','border-bottom:1px solid #d9d9d9;'],
				className:'employeeAccountLayer',
				content:storeEmployeeSection,
				type:1,
				anim:'up',
				style:'',
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
				},
				yes:function(index){
					var postData=$('.storeEmployeeForm').serializeObject();
					var content='';
					if(!postData.name){
						content='请填写员工姓名';
					}else if(!register.phoneCheck(postData.mobile_phone)){
						content='请填写手机号码';
					}
					if(content){
						dialog.error(content);
						return false;
					}
					postData.post = null;
					$.each($('.employeeAccountLayer').find('ul.post').find('li'),function(){
						if($(this).hasClass('current')){
							postData.post = $(this).data('id');
						}
					});
					postData.duty = null;
					$.each($('.employeeAccountLayer').find('ul.duty').find('li'),function(){
						if($(this).hasClass('current')){
							postData.duty = $(this).data('id');
						}
					});
					postData.nodeIds = [];
					$.each($('.employeeAccountLayer').find('ul.authentication').find('li'),function(){
						if($(this).hasClass('current')){
							postData.nodeIds.push($(this).data('id'));
						}
					});
					console.log(postData);return;
					 var config = {
					 	url:controller + 'storeEmployeeEdit',
					 	postData:postData,
					 	index:index,
					 	container:$('#storeEmployeeList').find('ul.list')
					 };
					 dialogFormAdd(config);
				}
			});
		});
		//修改线上店铺员工账号
		$('body').on('click','.modify-account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['修改线上店铺员工账号','border-bottom:1px solid #d9d9d9;'],
				className:'employeeAccountLayer',
				type:1,
				anim:'up',
				content:storeEmployeeSection,
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
					copyDataByName(_this,$('.employeeAccountLayer .storeEmployeeForm'));
				},
				yes:function(index){
					var postData=$('.employeeAccountLayer .storeEmployeeForm').serializeObject();
					var content='';
					if(!postData.name){
						content='请填写姓名';
					}else if(!register.phoneCheck(postData.mobile_phone)){
						content='请填写手机号码';
					}
					if(content){
						dialog.error(content);
						return false;
					}
					 var config = {
					 	url:controller + 'edit',
					 	postData:postData,
					 	fromObj:$('.employeeAccountLayer .storeEmployeeForm'),
					 	toObj:_this,
					 	index:index
					 };
					 dialogFormEdit(config);
					layer.close(index);

				}
			});
		});
		//删除线上店铺员工账号
		$('body').on('click','.delete-account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['删除线上店铺员工账号','border-bottom:1px solid #d9d9d9;color:#ff0000;'],
				className:'employeeAccountLayer',
				type:1,
				anim:'up',
				content:storeEmployeeSection,
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
					copyDataByName(_this,$('.employeeAccountLayer .storeEmployeeForm'));
				},
				yes:function(index){
					var postData = {};
					postData.id = _this.data('id');
					 var config = {
					 	url:controller + 'del',
					 	postData:postData,
					 	obj:_this,
					 	index:index
					 };
					 dialogFormDel(config);
				}
			});
		});

		//新增门店员工账号
		var shopEmployeeSection=$('#shopEmployeeSection').html();
		$('body').on('click','.add_store_account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['新增门店员工账号','border-bottom:1px solid #d9d9d9;'],
				className:'employeeAccountLayer',
				content:shopEmployeeSection,
				type:1,
				anim:'up',
				style:'',
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
				},
				yes:function(index){
					var postData=$('.storeEmployeeForm').serializeObject();
					var content='';
					if(!postData.name){
						content='请填写员工姓名';
					}else if(!register.phoneCheck(postData.mobile_phone)){
						content='请填写手机号码';
					}
					if(content){
						dialog.error(content);
						return false;
					}
					$.each($('.employeeAccountLayer').find('li'),function(){
						if($(this).attr('class')=='current'){
							postData.nodeIds.push($(this).data('id'));
						}
					});
					 var config = {
					 	url:module + 'shopEdit',
					 	postData:postData,
					 	index:index
					 };
					 dialogFormAdd(config);
					layer.close(index);
				}
			});
		});
		//修改门店员工账号
		$('body').on('click','.modify-shop-account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['修改门店员工账号','border-bottom:1px solid #d9d9d9;'],
				className:'employeeAccountLayer',
				type:1,
				anim:'up',
				content:shopEmployeeSection,
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
					copyDataByName(_this,$('.employeeAccountLayer .storeEmployeeForm'));
				},
				yes:function(index){
					var postData=$('.employeeAccountLayer .storeEmployeeForm').serializeObject();
					var content='';
					if(!postData.name){
						content='请填写姓名';
					}else if(!register.phoneCheck(postData.mobile_phone)){
						content='请填写手机号码';
					}
					if(content){
						dialog.error(content);
						return false;
					}
					 var config = {
					 	url:module + 'Manager/edit',
					 	postData:postData,
					 	fromObj:$('.employeeAccountLayer .storeEmployeeForm'),
					 	toObj:_this,
					 	index:index
					 };
					 dialogFormEdit(config);
					layer.close(index);

				}
			});
		});
		//删除门店员工账号
		$('body').on('click','.delete-shop-account',function(){
			var _this=$(this).parents('.list li');
			layer.open({
				title:['删除门店员工账号','border-bottom:1px solid #d9d9d9;color:#ff0000;'],
				className:'employeeAccountLayer',
				type:1,
				anim:'up',
				content:shopEmployeeSection,
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
					$('.employeeAccountLayer .storeEmployeeForm').css('height',winHeight-120+'px');
					copyDataByName(_this,$('.employeeAccountLayer .storeEmployeeForm'));
				},
				yes:function(index){
					var postData = {};
					postData.id = _this.data('id');
					postData.userFactoryId = _this.data('user_factory_id');
					 var config = {
					 	url:module + 'Manager/del',
					 	postData:postData,
					 	obj:_this,
					 	index:index
					 };
					 dialogFormDel(config);
				}
			});
		});
		//列表操作按钮
		$('body').on('click','.list li',function(){
			$(this).addClass('current').siblings().removeClass('current');
			$(this).find('.operate-btn').show();
			$(this).siblings().find('.operate-btn').hide();
		});
		//岗位职务设置样式
		$('body').on('click','.post_position li',function(){
			$(this).addClass('current').siblings().removeClass('current');
		});
		//账号授权设置样式
		$('body').on('click','.account_authorization li',function(){
			$(this).toggleClass('current');
		})
		//选择店铺样式
		$('body').on('click','.storeShopListLayer li',function(){
			$(this).parents('.store_list').find('li').removeClass('current');
			$(this).addClass('current').siblings().removeClass('current');
		});
		//门店店长管理和店铺店长管理切换
		$('body').on('click','.store_deploy_bar a',function(){
			var typeId=$(this).data('type');
			$(this).addClass('current').siblings().removeClass('current');
			
			if(typeId=='online'){
				$('.top_empy_nav').hide().eq($(this).index()).css('display','flex');
				$('.top_empy_nav a').removeClass('current');
				$('.top_empy_nav a:first').addClass('current');
				$('.content_main .section_content').hide();
				$('.content_main section').eq(0).show();
			}else{
				$('.top_empy_nav').hide().eq($(this).index()).css('display','flex');
				$('.top_empy_nav a').removeClass('current');
				$('.top_empy_nav').eq(1).find('a:first').addClass('current');
				$('.content_main .section_content').hide();
				$('.content_main').find('#shopEmployeeList').show();
				
			}	
		});
		$('body').on('click','.top_empy_nav a',function(){
			var typeId=$(this).data('type');
			$(this).addClass('current').siblings().removeClass('current');
			switch(typeId){
				case 0:
					$('.section_content').siblings().hide();
					$('.content_main').find('#storeEmployeeList').show();
					break;
				case 1:
					$('.section_content').siblings().hide();
					$('.content_main').find('#consigneeInfo').show();
					break;
				case 2:
					$('.section_content').siblings().hide();
					$('.content_main').find('#shopEmployeeList').show();
					break;
				case 3:
					$('.section_content').siblings().hide();
					$('.content_main').find('#shopAddressList').show();
					break;
				case 4:
					$('.section_content').siblings().hide();
					$('.content_main').find('#shopConsigneeList').show();
			}
		})
	});
</script>
<script type="text/javascript" src="public_js/jquery.area.js"></script>
{/block}