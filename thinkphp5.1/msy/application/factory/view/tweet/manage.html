{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="content"}
<section id="releaseFileContent" style="display: none;">
	<div class="release-file">
		<a href="javascript:void(0);" class="release-img" data-type="1">图片消息（最多9张图）</a>
		<a href="javascript:void(0);" data-type="2">小视频（不超过10秒）</a>
		<a href="javascript:void(0);" data-type="3">视频 （不超过3分钟）</a>
		<a href="javascript:void(0);" data-type="4">文章（视频+文字+图片）</a>
	</div>
</section>
<!--云推客发布图片消息-->
<section id="cloudImgTwitter" style="display: none;">
	<form class="releaseInfoForm">
		<div class="twitter-release-content">
			<textarea name="msgText" class="twitter-text" rows="" cols="" placeholder="消息文字..."></textarea>
			<ul class="upload-picture-module multi-picture-module">
			</ul>
			<div class="error_tipc"></div>
			<div class="release-news">
				<span class="video-camera"></span>
				<input class="camera-btn uploadSingleImg" type="file" id="file" capture="camera" data-num="9" multiple>
				<input type="hidden" name="msgfile" class="msg-img">
			</div>
			<a href="javascript:void(0);" class="link-store-goods">设定链接的商家店铺商品（可选）></a>
			<input type="hidden" name="storeGoods" class="store-goods">
		</div>
	</form>
</section>
<!--云推客发布视频消息-->
<section id="cloudVideoTwitter" style="display: none;">
	<form class="releaseInfoForm">
		<textarea name="msgText" class="twitter-text" rows="" cols="" placeholder="视频说明文字..."></textarea>
		<div class="error_tipc"></div>
		<div class="upload-picture-module f24">
			<div>
				<div class="picture-module">
					<input type="file" class="uploadImg uploadSingleVideo" name="" data-duration="">
					<video class="upload_img upload-video" src="" autoplay="autoplay"></video>
					<input type="hidden" name="msgfile" class="img" data-src="" value="">
				</div>
			</div>
		</div>
		<a href="javascript:void(0);" class="link-store-goods">设定链接的商家店铺商品（可选）></a>
		<input type="hidden" name="storeGoods" class="store-goods">
	</form>
</section>
<!--云推客发布文章-->
<section id="cloudArticleTwitter" style="display: none;">
	<p>*编辑完文字图片后再按发布</p>
	<div class="error_tipc"></div>
	<form class="releaseInfoForm">
		<div class="separation-line columns_flex l-r-sides release-file-module ">
			<div class="upload-picture-module f24">
				<div>
					<div class="picture-module">
						<input type="file" class="uploadImg uploadSingleImg" name="">
						<img class="upload_img" src="" alt="">
						<input type="hidden" name="msgfile" class="img" data-src="" value="">
					</div>
					<p>上传配图</p>
				</div>
			</div>
			<div>
				<textarea name="msgText" class="twitter-text" rows="" cols="" placeholder="输入标题文字不超过28字"></textarea>
			</div>
		</div>
		<div class="separation-line columns_flex l-r-sides release-file-module ">
			<div class="upload-picture-module f24">
				<div>
					<div class="picture-module">
						<input type="file" class="uploadImg uploadSingleVideo" name="">
						<video class="upload_img upload-video" src="" autoplay="autoplay"></video>
						<input type="hidden"  name="msgfile" class="img" data-src="" value="">
					</div>
					<p>上传视频(可不选)</p>
				</div>
			</div>
			<div>
				<textarea name="msgText" class="twitter-text" rows="" cols="" placeholder="输入标题文字不超过28字"></textarea>
			</div>
		</div>
		<a href="javascript:void(0);" class="link-store-goods">设定链接的商家店铺商品（可选）></a>
		<input type="hidden" name="storeGoods" class="store-goods">
	</form>
	<div class="paragraph-module">
		<textarea class="twitter-text" rows="" cols="" placeholder="段落文字粘贴..."></textarea>
		<div class="upload-picture-module release-file-module f24">
			<div>
				<div class="picture-module">
					<input type="file" class="uploadImg uploadSingleImg" name="">
					<img class="upload_img" src="" alt="">
					<input type="hidden" class="img" data-src="" value="">
				</div>
				<p>上传插图（可选项，建议图片宽950像素）</p>
			</div>
		</div>
	</div>
	<a href="javascript:void(0);" class="insert-button">插入段落文字图片</a>
</section>
<!--段落文字图片-->
<section id="paragraphLayer" style="display: none;">
	<div class="paragraph-module">
		<textarea class="twitter-text" rows="" cols="" placeholder="段落文字粘贴..."></textarea>
		<div class="upload-picture-module release-file-module f24">
			<div>
				<div class="picture-module">
					<input type="file" class="uploadImg uploadSingleImg" name="">
					<img class="upload_img" src="" alt="">
					<input type="hidden" class="img" data-src="" value="">
				</div>
				<p>上传插图（可选项，建议图片宽950像素）</p>
			</div>
		</div>
	</div>
</section>

<article class="f24">
	<!--店铺运营头部-->
	{include file="public/store_operation_head" /}
	<section class="bottomLine">
		<nav class="columns_flex channel_nav manufacturer_nav">
			<a href="{:url('Operation/index')}">
				店铺提醒
			</a>
			<a href="{:url('Goods/manage')}">
				店铺管理
			</a>
			<a href=""  class="current">
				营销推广
			</a>
			<a href="javascript:void (0)">
				官方活动
			</a>
		</nav>
	</section>
	<section class="specific_type store-manage-type bottomLine">
		<div class="columns_flex f20">
			<a  href="javascript:void (0)" class="column_type current">场景</a>
			<a >云推客</a>
			<a href="javascript:void (0)">线上</a>
			<a href="javascript:void (0)">线下</a>
			<a href="javascript:void (0)">视频</a>
			<a href="javascript:void (0)">直播</a>
		</div>
	</section>
	<section class="content-padding twitter-release-content">
		<div class="twitter_flex">
			<div class="release-date">
				<span>今天</span>
			</div>
			<div class="release-news">
				<!--accept="image/*"   multiple属性是多选-->
				<!--<span class="video-camera"></span>
                <input class="camera-btn" type="file" id="file" multiple="" capture="camera" >-->
				<a class="video-camera release-msg" href="javascript:void(0);"></a>
			</div>
		</div>
		<div class="twitter_flex">
			<div class="release-date">
				<span>083月</span>
			</div>
			<div class="release-news">
				<div class="news-item">
					<div class="photo-frame">
						<img class="common_default_img" src="public/static/common/img/icons/long.png" alt="">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner1.jpg" alt="">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner.jpg" alt="">
					</div>
					<div >
						<p>这个产品挺好用的这个产品挺好用的这个产品挺好用的这个产品挺好用的</p>
						<span>共<span>2</span>张</span>
					</div>
				</div>
				<div class="news-item">
					<div class="photo-frame">
						<!--<img class="common_default_img" src="public/static/common/img/default/no_pic_100.jpg" alt="">-->
						<img class="common_default_img" src="public/static/common/img/icons/long.png" alt="">
						<img class="common_default_img" src="public/static/common/img/icons/long.png" alt="">
					</div>
					<div >
						<p>这个产品挺好用的这个产品挺好用的这个产品挺好用的这个产品挺好用的</p>
						<span>共<span>2</span>张</span>
					</div>
				</div>
			</div>
		</div>
		<div class="twitter_flex">
			<div class="release-date">
				<span>083月</span>
			</div>
			<div class="release-news">
				<div class="news-item">
					<div class="photo-frame">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner1.jpg" alt="">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner1.jpg" alt="">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner.jpg" alt="">
						<img class="common_default_img" src="public/static/common/img/banner/wt-banner1.jpg" alt="">
					</div>
					<div >
						<p>这个产品挺好用的这个产品挺好用的这个产品挺好用的这个产品挺好用的</p>
						<span>共<span>2</span>张</span>
					</div>
				</div>
				<div class="news-item">
					<div class="photo-frame">
						<!--<img class="common_default_img" src="public/static/common/img/default/no_pic_100.jpg" alt="">-->
						<img class="common_default_img" src="public/static/common/img/icons/long.png" alt="">
						<img class="common_default_img" src="public/static/common/img/icons/long.png" alt="">
					</div>
					<div >
						<p>这个产品挺好用的这个产品挺好用的这个产品挺好用的这个产品挺好用的</p>
						<span>共<span>2</span>张</span>
					</div>
				</div>
			</div>
		</div>
	</section>

</article>
{/block}
{block name="common"}
{include file="template/loading.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript" src="public_js/paging.js"></script>
<script type="text/javascript" src="public_js/swiper.min.js"></script>
<script type="text/javascript" src="public_js/uploadImgToTemp.js"></script>
<script type="text/javascript" src="public_js/uploadMultiImg.js"></script>

<script type="text/javascript">
//	var config = {
//		url:module+'promotion/getList',
//		requestEnd:false,
//		loadTrigger:false,
//		currentPage:1,
//		callBack:callBack,
//		container1:$('.promotion-item .content-label')
//	};
//	var postData = {
//		pageSize:10
//	};
//	$(function () {
//		//没有默认店铺
//		var notDefaultStore = "{$notDefaultStore|default=0}";
//		if(notDefaultStore == 0){
////			//初始化
////			postData.activityStatus = $('.category-tab li.current a').data('activity-status');
////			getPagingList(config,postData);
//		}
//
//		//点击新建促销活动
//		$('body').on('click','.addSalesActivity',function () {
//			location.href = module + 'promotion/edit'
//		});
//
//		//根据促销活动状态获取活动列表
//		$('body').on('click','.category-tab li',function () {
//			$(this).addClass('current').siblings().removeClass('current');
//			postData.activityStatus = $(this).find('a').data('activity-status');
//			config.currentPage = 1;
//			config.requestEnd = false;
//			getPagingList(config,postData);
//		})
//
//		//删除促销活动
//		$('body').on('click','.del-icons',function () {
//			var _this = $(this);
//			var postData = {};
//			postData.id = _this.parent().data('id');
//			$.post(module+'Promotion/del',postData,function (msg) {
//				if(msg.status == 0){
//					dialog.error(msg.info);
//					return false;
//				}
//				_this.parents('.tag-item').remove();
//				dialog.success(msg.info);
//			})
//		})
//	});
	$(function(){
		//轮播
//		var swiper1 = new Swiper('.swiper-container', {
//			spaceBetween: 30,
//			pagination: {
//				el: '.swiper-pagination',
//				clickable: true
//			}
//		});
		// swiper('.swiper-focus-container');
		var paragraphLayer=$('#paragraphLayer').html();
		//添加段落文章和图片
		$('body').on('click','.insert-button',function(){
			$('.editDetailLayer .paragraph-module:last').after(paragraphLayer);
		})
		//推文类型弹窗
		var releaseFile=$('#releaseFileContent').html();
		$('body').on('click','.release-msg',function(){
			var pageii = layer.open({
				className:'releaseFileLayer',
				content: releaseFile,
				shadeClose:false,
				success:function(){
					var winHeight=$(window).height();
					$('.twitter-release-content').css('height',winHeight-120+'px');
					$('.layui-m-layermain .layui-m-layersection').addClass('bottom-layer');
				},
				btn:['取消']
			});
		});
		//发布推文选项
		$('body').on('click','.release-file a',function(){
			var releaseType=$(this).data('type');
			var opt={};
			if(releaseType==1){
				var cloudTwitter=$('#cloudImgTwitter').html();
				opt={
					content:cloudTwitter,
					title:'发图片消息',
					msg:'请上传图片'
				}
			}else if(releaseType==2){
				var cloudTwitter=$('#cloudVideoTwitter').html();
				opt={
					content:cloudTwitter,
					title:'发小视频',
					msg:'请上传小视频',
					duration:10
				}
			}else if(releaseType==3){
				var cloudTwitter=$('#cloudVideoTwitter').html();
				opt={
					content:cloudTwitter,
					title:'发视频',
					msg:'请上传视频',
					duration:180
				}
			}else{
				var cloudTwitter=$('#cloudArticleTwitter').html();
				opt={
					content:cloudTwitter,
					title:'发文章',
					paragraphAttr:[]
				}
			}
			releaseFileLayer(opt);
		});
		//发布弹窗
		function releaseFileLayer(options){
			layer.open({
				title:[options.title,'border-bottom:1px solid #d9d9d9;'],
				className:'editDetailLayer',
				// type: 1,
				content: options.content,
				// anim: 'up',
				success:function(){
					var winHeight=$(window).height();
					$('.editDetailLayer .layui-m-layercont').css('height',winHeight-120+'px');
					$('.editDetailLayer .uploadSingleVideo').data('duration',options.duration);
				},
				btn:['发布','取消'],
				yes:function(){
					var layermultiImgAttr=[];
					//获取图片路径
					$.each($('.editDetailLayer li'),function(i,val){
						var _this=$(this);
						var imgSrc=_this.find('img').attr('src');
						layermultiImgAttr.push(imgSrc);
					})
					//获取文章段落和图片数据
					options.paragraphAttr=[];
					$.each($('.editDetailLayer .paragraph-module'),function(i,val){
						var _this=$(this);
						var mesObject={};
						var mesText=_this.find('.twitter-text').val();
						var mesImgSrc=_this.find('.img').val();
						mesObject={
							mesText:mesText,
							mesImgSrc:mesImgSrc
						}
						options.paragraphAttr.push(mesObject);
					})
					console.log(options.paragraphAttr);
					$('.msg-img').val(layermultiImgAttr);
					//序列化表单数据
					var releaseFormData=$('.editDetailLayer .releaseInfoForm').serializeObject();
					var content='';
					if(!releaseFormData.msgText){
						content='请填写消息内容';
					}else if(!releaseFormData.msgfile){
						content=options.msg;
					}else if(!releaseFormData.storeGoods){
						content='请链接商家商品';
					}
					if(content){
						errorTipc(content);
						return false;
					}
					$.ajax({
						url:'',
						type:'',
						data:{},
						success:function(){

						},
						error:function(){

						}
					})
				}
			});
		}
	})

	//下拉加载
	$('.classify-label-content').on('scroll',function(){
		var listHeight=document.getElementById('list').scrollHeight;
		if(config.loadTrigger && $('.classify-label-content ').scrollTop()+$('.classify-label-content ').height()>=listHeight){
			config.loadTrigger = false;
			config.activityStatus = $('.category-tab li.current a').data('activity-status');
			getPagingList(config,postData);
		}
	});
</script>
{/block}