{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="title"}开店部署{/block}
{block name="content"}
<section id="groupRole" style="display: none;">
	<div class="groupRole-box">
		<input class="role-name input-filed" type="text" value="" placeholder="请输入角色名称">
	</div>
</section>
<section id="rolePower" style="display: none;">
	{include file="role/node_list_tpl" /}
</section>
<article class="f24">
	<section class="top_nav_fixed">
		<div class="top_bar top-switch-bar columns_flex l-r-sides">
			<div class="">
				<a class="home">首页</a>
			</div>
			<div class="">
				<img class="left" src="public_img/default/no_pic_40.jpg" alt="">
				<span>爱国宾</span>
			</div>
			<div class="">
				<a class="switch-account">切换供应商账号></a>
			</div>
		</div>
	</section>
	<section class="specific_type bottomLine">
		<div class="columns_flex f20">
			<a>企业档案</a>
			<a>商标备案</a>
			<a>开店申请</a>
			<a class="column_type current">组别角色</a>
			<a>账号授权</a>
		</div>
	</section>
	<section class="f24 ">
		<div class="page-bd">
			<nav class="apply-data-nav">
				<ul id="status " class="status f24 weui-flex group-role-nav">
					<li class="weui-flex-item "><a href="{:url('Organize/index')}"><span class="ogranzi"></span><em></em>组织</a></li>
					<li class="weui-flex-item "><a href="javascript:void(0);"><span class="group"></span><em></em>组别</a></li>
					<li class="weui-flex-item current"><a href="{:url('Role/index')}"><span class="role"></span><em></em>角色</a></li>
					<li class="weui-flex-item "><a href="javascript:void(0);"><span class="juris"></span>权限</a></li>
				</ul>
			</nav>
		</div>
	</section>
	<section>
		<ul class="account-role-list role-list"></ul>
		<div class="add-role">
			<a href="javascript:void(0);" class="add">+</a>
		</div>
	</section>
	<p class="f20 content-box group-role-tipc">提示：选择角色进行默认权限的设定，全部角色默认权限设定后再按确定。</p>
	<!--<a href="javascript:void(0);" class="add-account foot-btn">下一步</a>-->
</article>
{/block}
{block name="common"}
{include file="template/footer_menu_msy.html" /}
{include file="template/right_side_bar.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript">
	$(function () {
		//初始化
		getRoleList();
		//新增角色
		var groupRole=$('#groupRole').html();
		$('body').on('click','.add',function(){
			var _this = $(this);
			layer.open({
				title:['新增角色','border-bottom:1px solid #d9d9d9;'],
				className:'groupRole',
				content:groupRole,
				btn:['确定','取消'],
				yes:function(index){
					var postData = {};
					postData.name = $('div.groupRole').find('input').val();
					$.post(action,postData,function(data){
						$('ul.role-list').append(data);
						layer.close(index);
					});
				}
			});
		});
		//修改角色
		$('body').on('click','.edit',function(){
			var _this = $(this);
			var _thisLi = _this.parent().parent();
			layer.open({
				title:['新增角色','border-bottom:1px solid #d9d9d9;'],
				className:'groupRole',
				content:groupRole,
				btn:['确定','取消'],
				success:function(){
					$('div.groupRole').find('input').val(_thisLi.find('span').text());
				},
				yes:function(index){
					var postData = {};
					postData.id = _thisLi.data('id');
					postData.name = $('div.groupRole').find('input').val();
					$.post(action,postData,function(data){
						_thisLi.replaceWith(data);
						layer.close(index);
					});
				}
			});
		});
		//权限选择-样式
		$('body').on('click','.rolePowerLayer li',function(){
			$(this).toggleClass('current');
		});
		//赋权
		var rolePower=$('#rolePower').html();
		$('body').on('click','.power',function(){
			var _this = $(this);
			var _thisLi = _this.parent().parent();
			layer.open({
				className:'rolePowerLayer',
				type: 1,
				anim: 'up',
				style: 'position:fixed; left:0; top:0; width:100%; height:100%; border: none; -webkit-animation-duration: .5s; animation-duration: .5s;',
				content:rolePower,
				btn:['确定','取消'],
				success:function(){
					var winHeight=$(window).height();
					$('.rolePowerLayer .layui-m-layercont').css('height',winHeight-50+'px');
					var postData = {};
					postData.roleId = _thisLi.data('id');
					$.post(controller+'getRoleNode',function(data){
						console.log(data);
					});
				},
				yes:function(index){
				}
			});
		});
		//删除
		$('body').on('click','.reduce',function(){
			var _thisLi = $(this).parent().parent();
			var postData = {};
			postData.id = _thisLi.data('id');
			var url = controller + 'del';
			$.post(url,postData,function(data){
				_thisLi.remove();
			});
		});
	});
	//获取组织列表
	function getRoleList() {
		var postData = {};
		var url = controller + 'getList';
		$.get(url,postData,function(data){
			$('ul.role-list').append(data);
		});
	}
</script>
{/block}