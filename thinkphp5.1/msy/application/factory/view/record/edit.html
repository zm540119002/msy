{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="content"}
<!--企业标志截图-->
<section class="htmleaf-container" style="display: none;">
	<div id="clipArea">
		<div class="photo-clip-view" >
			<div class="photo-clip-moveLayer" >
				<div class="photo-clip-rotateLayer"></div>
			</div>
		</div>
		<div class="photo-clip-mask">
			<div class="photo-clip-mask-left"></div>
			<div class="photo-clip-mask-right" ></div>
			<div class="photo-clip-mask-top" ></div>
			<div class="photo-clip-mask-bottom" ></div>
			<div class="photo-clip-area" ></div>
		</div>
		<a href="javascript:void(0);" class="photoClip-close ">X</a>
	</div>
	<div class="foot-use f28">
		<div class="uploader1 blue">
			<input type="button" name="file" class="button" value="打开图片">
			<input id="file" type="file" onchange="javascript:void(0);" accept="image/*" multiple="" />
		</div>
		<button id="clipBtn">截取</button>
	</div>
	<div id="view" class="photoview" ></div>
</section>
<!--省市区-->
<section id="areaLayer" class="express-area-box" style="display:none;">
	<header>
		<h3>选择地区</h3>
		<a id="backUp" class="back" href="javascript:void(0)" title="返回" style="display: none;"></a>
		<a id="closeArea" class="close" href="javascript:void(0)" title="关闭"></a>
	</header>
	<article id="areaBox">
		<ul id="areaList" class="area-list"></ul>
	</article>
</section>
<!--视频-->
<section id="companyVideoList" style="display: none;">
	<p class="f20 upload_st_logo"><span class="friend-tipc">*注意</span>：必须上传视频(格式为)</p>
	<form class="">
		<ul class="upload-picture-module multi-picture-module f24"></ul>
	</form>
	<div class="error_tipc"></div>
	<div class="upload-picture-module f24">
		<div>
			<div class="picture-module">
				<input type="file" class="uploadImg uploadVideoDescribe" name="" accept="video/*"  >
				<!--<img class="upload_img" src="" alt="">
                <input type="hidden" class="layer-thumbnail-picture" value=""/>-->
			</div>
			<!--<p>企业营业执照</p>-->
		</div>
	</div>
</section>
<!--编辑企业简介-->
<section id="editGoodsParameter" style="display: none;">
	<div>
		<textarea name="" id="" cols="30" rows="10" placeholder="企业简介" class="editGoodsText"></textarea>
	</div>
</section>
<!--上传企业照片-->
<section id="uploadCompanyPic" style="display: none;">
	<p class="f20 upload_st_logo"><span class="friend-tipc">*注意</span>：必须上传图片(格式为jpg、jpeg、png、gif)</p>
	<form class="">
		<ul class="upload-picture-module multi-picture-module f24">
		</ul>
	</form>
	<div class="upload-picture-module f24">
		<div>
			<div class="picture-module">
				<input type="file" class="uploadImg uploadImgDescribe " name="" accept="image/*" >
			</div>
		</div>
	</div>
</section>
<article class="f24">
	<section>
		<form class="addProductContent qualificationContent">
			{notempty name="recordInfo"}
			<input type="hidden" name="record_id" value="{$recordInfo.id|default=''}">
			{/notempty}
			<div class="upload-company-map f24">
				<div>
					<div class="picture-module company-picture-module active">
						<input type="file" class="uploadImg uploadSingleImg" name="">
						{notempty name="recordInfo.company_img"}
						<img class="upload_img common_default_img" src="public_uploads/{$recordInfo.company_img|default=''}" alt="">
						{else /}
						<img class="upload_img common_default_img" src="public_img/default/no_pic_100.jpg" alt="">
						{/notempty}
						<input type="hidden" class="business-license img" value="{$recordInfo.company_img|default=''}" name="company_img"/>
					</div>
					<!--<p>企业营业执照</p>-->
				</div>
			</div>
			<ul class="content-marginLeft">
				<!--<li>-->
					<!--<div class="company-n">-->
						<!--<span>企业全称</span>-->
						<!--{$factoryInfo.name|default=''}-->
					<!--</div>-->
				<!--</li>-->
				<!--<li>-->
					<!--<input type="text" value="{$recordInfo.shop_name|default=''}" placeholder="填写店铺名称" class=" input-text" name="shop_name" >-->
				<!--</li>-->
				<li>
					<div class="express-area area-box">
						<a id="expressArea" href="javascript:void(0)" class="f24 form-group box-flex">
							<label class="form-label">所在地区：</label>
							<div class="area_address">省 &gt; 市 &gt; 区/县</div>
							<input type="hidden" value="" class="area-address-name" data-key="{$recordInfo.provinces|default=''}" name="provinces">
						</a>
					</div>
				</li>
				<li>
					<input type="text" class="detail-address" value="{$recordInfo.detail_address|default=''}" placeholder="填写详细地址" name="detail_address" >
				</li>
				<li>
					<div class="logo-license">
						<div class="half">
							<a class="logo" id="logox">
								{notempty name="recordInfo.logo_img"}
								<img src="public_uploads/{$recordInfo.logo_img|default=''}" />
								{else /}
								<img src="public_img/default/no_pic_40.jpg" />
								{/notempty}
								<input type="hidden" class="logo-src" name="logo_img" value="{$recordInfo.logo_img|default=''}">
							</a>
							<p class="f24">企业标志</p>
						</div>
						<div class="clear"></div>
					</div>
				</li>
				<!--<li >
					<a href="http://192.168.1.101:8008/demo/trademark.html" class="right-arrow" >企业商标备案</a>
					<input type="hidden" class="" value="" name="" />
				</li>-->
				<li class="">
					<a href="javascript:void(0);" class="editGoodsParameter right-arrow">编辑企业简介</a>
					<input type="hidden" class="company-introduce" value="{$recordInfo.introduction|default=''}" name="introduction"/>
				</li>
				<li class="">
					<a href="javascript:void(0);" class="companyVideoList right-arrow">上传企业视频</a>
					<input type="hidden" class="company-video" value="" name="factory_video" data-src="{$recordInfo.factory_video|default=''}">
				</li>
				<li class="">
					<a href="javascript:void(0);" class="uploadDeveloPic uploadCompanyPic right-arrow">上传研发生产照片</a>
					<input type="hidden" class="development-picture" data-src="{$recordInfo.rb_img|default=''}" value="" name="rb_img">
				</li>
				<li class="">
					<a href="javascript:void(0);" class="uploadLicensePic uploadCompanyPic right-arrow">上传企业执照资质</a>
					<input type="hidden" class="license-picture" data-src="{$recordInfo.license|default=''}" value="" name="license">
				</li>
				<li class="">
					<a href="javascript:void(0);" class="uploadHonorPic uploadCompanyPic right-arrow">上传企业专利荣誉</a>
					<input type="hidden" class="honor-picture" data-src="{$recordInfo.glory_img|default=''}" value="" name="glory_img">
				</li>
			</ul>
		</form>
	</section>
</article>
<a href="javascript:void(0);" class="identifyNewGoods foot-btn f24">确定</a>
<div id="areaMask" class="mask"></div>


{/block}
{block name="common"}
{include file="template/right_side_bar.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript" src="public_js/swipe.js"></script>
<script type="text/javascript" src="public_js/uploadImgToTemp.js"></script>
<script type="text/javascript" src="public_js/uploadMultiImg.js"></script>
<script type="text/javascript" src="public_js/jquery.area.js"></script>
<script type="text/javascript" src="public_js/hammer.js"></script>
<script type="text/javascript" src="public_js/iscroll-zoom.js"></script>
<script type="text/javascript" src="public_js/jquery.photoClip.js"></script>

<script type="text/javascript">
	$(function(){
		//初始化地址
		var addressIndex=$('.area-address-name').data('key');
		
		if(addressIndex){
			var areaAddressArr=addressIndex.split(',');
			$('.area_address').setArea(areaAddressArr);
		}
		
		//编辑企业简介
		var editGoodsParameter=$('#editGoodsParameter').html();
		$('body').on('click','.editGoodsParameter',function(){
			layer.open({
				title:['编辑企业简介','border-bottom:1px solid #d9d9d9;'],
				className:'editParameterLayer',
				content:editGoodsParameter,
				btn:['确定','取消'],
				success:function(){
					var goodsParameter=$('.company-introduce').val();
					$('.editParameterLayer .editGoodsText').val(goodsParameter);
				},
				yes:function(index){
					var editGoodsText=$('.editParameterLayer .editGoodsText').val();
					$('.company-introduce').val(editGoodsText);
					layer.close(index);
				}
			})
		});
		//裁剪商标logo
		var clipImg = '';
		$("#clipArea").photoClip({
			width: 199,
			height: 166,
			file: "#file",
			view: "#view",
			ok: "#clipBtn",
			clipFinish: function(img) {
				clipImg = img;
				 $.post(controller + "uploadImgToTemp", { img: clipImg , compress:false },function(msg){
				     if(msg.status == 0){
				         layer.open({
				             content:msg.info,
				             time:2
				         });
				         return false;
				     }else if(msg.status == 1){
						 $('.logo-src').val(msg.info);
				     }
				 },'json');
			}
		});
		$(".logo").click(function(){
			$(".htmleaf-container").show();
		});
		$("#clipBtn").click(function(){
			$('.logo img').attr('src',clipImg).addClass('active');
			$('.logo-src').val(clipImg);
			$(".htmleaf-container").hide();
		});
		$('.photoClip-close').click(function(){
			$(".htmleaf-container").hide();
		});
		//提交档案信息
		$('body').on('click','.identifyNewGoods',function(){
			var postData={};
			postData=$('.qualificationContent').serializeObject();
			postData.provinces=$('.area-address-name').data('key');
			var rb_img = $('.development-picture').data('src');
				postData.rb_img = rb_img;
			var license=$('.license-picture').data('src');
				postData.license = license;
			var glory_img=$('.honor-picture').data('src');
				postData.glory_img = glory_img;
			var factory_video=$('.company-video').data('src');
				postData.factory_video = factory_video;
			console.log(postData);
			return false;
//			postData.factory_video=$('.company-video').data('src');
			var content='';
//			if(!postData.company_img){
//				content='请上传企业形象图片';
//			}else if(!postData.shop_name){
//				content='请填写店铺名称';
//			}else if(!postData.provinces){
//				content='请选择所在的省市区';
//			}else if(!postData.detail_address){
//				content='请填写详细地址';
//			}else if(!postData.logo_img){
//				content='请上传企业标志图';
//			}else if(!postData.introduction){
//				content='请填写企业简介';
//			}else if(!postData.factory_video||postData.factory_video==0){
//				content='请上传企业视频';
//			}else if(!postData.rb_img||postData.rb_img==0){
//				content='请上传企业研发生产图片';
//			}else if(!postData.license||postData.license==0){
//				content='请上传执照资质图片';
//			}else if(!postData.glory_img||postData.glory_img==0){
//				content='请上传专利荣誉图片';
//			}
//			if(content){
//				dialog.error(content);
//				return false;
//			}

//			$.post(controller + "edit",postData,function(msg){
//
////				if(msg.status == 0){
////					layer.open({
////						content:msg.info,
////						time:2
////					});
////					return false;
////				}else if(msg.status == 1){
////					$('.logo-src').val(msg.info);
////				}
//			},'json');
			
			$.ajax({
				url:controller + "edit",
				type:'post',
				data:postData,
				success:function (msg) {
				   if(msg.status == 0){
						layer.open({
							content:msg.info,
							time:2
						});
						return false;
					}else if(msg.status == 1){
						dialog.success(msg.info,controller+'preview')
					}
				},
				error:function (xhr) {
					dialog.error(xhr)
				},

				
				
			})
		})

	})

</script>
{/block}