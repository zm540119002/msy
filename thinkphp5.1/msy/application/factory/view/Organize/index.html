{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="title"}开店部署{/block}
{block name="content"}
<section id="groupRole" style="display: none;">
	<div class="groupRole-box">
		<input class="role-name input-filed" type="text" name="" value="" placeholder="请输入组别名称">
	</div>
</section>
<article class="f24">
	<section class="top_nav_fixed">
		<div class="top_bar top-switch-bar columns_flex l-r-sides">
			<div class="">
				<a class="home">首页</a>
			</div>
			<div class="">
				<img class="left" src="public_img/default/no_pic_40.jpg" alt="">
				<span>爱国宾</span>
			</div>
			<div class="">
				<a class="switch-account">切换供应商账号></a>
			</div>
		</div>
	</section>
	<section class="specific_type bottomLine">
		<div class="columns_flex f20">
			<a >企业档案</a>
			<a>商标备案</a>
			<a>开店申请</a>
			<a class="column_type current">组别角色</a>
			<a>账号授权</a>
		</div>
	</section>
	<section class="f24 ">
		<div class="page-bd">
			<nav class="apply-data-nav">
				<ul id="status " class="status f24 weui-flex group-role-nav">
					<li class="weui-flex-item switch-item current"><span class="ogranzi"></span><em></em>组织</li>
					<li class="weui-flex-item switch-item "><span class="group"></span><em></em>组别</li>
					<li class="weui-flex-item "><span class="role"></span><em></em>角色</li>
					<li class="weui-flex-item "><span class="juris"></span>权限</li>
				</ul>
			</nav>
		</div>
	</section>
	<section class="organize">
		<!--组织根节点，默认id为1，上级为0 ，级别为0-->
		<ul data-id="1" data-superior_id="0" data-level="0">
			<li>
				<span class="content-label">总经办</span>
				<div class="operate-box">
					<a class="btn edit">i</a>
					<a class="btn add">+</a>
				</div>
			</li>
		</ul>
	</section>
	<p class="f20 content-box group-role-tipc">说明：这里仅构建与企业云端店铺经营直接相关的业务组织架构，点击    键可增加所在部门的分支/部门；点击部门框可修改名称；消除部门框内容相同于删除该部门；如正在删除的部门有分支部门，请先删除其分支部门再删除该部门；建议企业部门的级别不超过5级，企业部门设置完成后再按下一步。</p>
	<a href="javascript:void(0);" class="add-account foot-btn">下一步</a>
</article>
{/block}
{block name="common"}
{include file="template/footer_menu_msy.html" /}
{include file="template/right_side_bar.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript">
$(function () {
	//新增下级
	$('body').on('click','.add',function(){
		var _this = $(this);
		layer.open({
			title:['填写组别名称','border-bottom:1px solid #d9d9d9;'],
			className:'groupRoleLayer',
			content:$('#groupRole').html(),
			btn:['确定','取消'],
			yes:function (index) {
				var postData = {};
				postData.organize_id = _this.parent().parent().parent().data('id');
				postData.level = _this.parent().parent().parent().data('level');
				postData.name = $('div.groupRoleLayer').find('input').val();
				$.post(action,postData,function(data){
					_this.parent().after(data);
					layer.close(index)
				});
			}
		});
	});

	//修改本级
	$('body').on('click','.edit',function(){
		var _this = $(this);
		layer.open({
			title:['填写组别名称','border-bottom:1px solid #d9d9d9;'],
			className:'groupRoleLayer',
			content:$('#groupRole').html(),
			btn:['确定','取消'],
			yes:function (index) {
				var postData = {};
				postData.id = _this.parent().parent().parent().data('id');
				postData.name = $('div.groupRoleLayer').find('input').val();
				$.post(action,postData,function(data){
					if(data.status==0){
						dialog.error(data.info);
						return false;
					}else if(data.status==1){
						layer.close(index)
					}
				});
			}
		});
	});

	//初始化
	getOrganizeList();
});

//获取组织列表
function getOrganizeList() {
	var postData = {};
	var url = controller + 'getOrganizeList';
	$.get(url,postData,function(data){
		$('section.organize').find('div.operate-box').append(data);
	});
}
</script>
{/block}