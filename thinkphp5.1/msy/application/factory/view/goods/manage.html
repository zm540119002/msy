{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="content"}
<section class="f24" id="databaseContent" style="display:none;">
	<nav class="goods-database-nav">
		<ul class="columns_flex">
			<li class="current">选择源文件</li>
			<li>选择性复制</li>
		</ul>
	</nav>
	<div class="database-item">
		<ul class="goods-store-content">
			{notempty name="selfStore"}
			<li class="columns_flex" data-store-id="{$selfStore.id}">
				<div>
					{notempty name="selfStore.img"}
					<img src="public_uploads/{$selfStore.img}" alt="" class="small_default_img">
					{else /}
					<img src="public_uploads/default/no_pic_40.jpg" alt="">
					{/notempty}
				</div>
				<div>
					<p>本店铺商品数据备份</p>
					<p><span>日期：{$selfStore.backup_time}</span></p>
				</div>
			</li>
			{/notempty}
		</ul>
		<ul class="goods-store-content">
			{notempty name="otherStores"}
			{volist name="otherStores" id="vo"}
			<li class="columns_flex l-r-sides" data-store-id="{$vo.id}">
				<div>
					{notempty name="vo.img"}
					<img src="public_uploads/{$vo.img}" alt="" class="small_default_img">
					{else /}
					<img src="public_uploads/default/no_pic_40.jpg" alt="">
					{/notempty}
				</div>
				<div>
					{if $vo.store_type == 1 }
					<span>{$vo.name}</span>官方旗舰店
					{elseif $vo.store_type == 2/}
					<span>{$vo.name}</span>品牌旗舰店
					{else /}
					{/if}

					{if $vo.run_type == 1 }
					<p>B2B采购商城</p>
					{elseif $vo.run_type == 2 /}
					<p>B2B分成商城</p>
					{elseif $vo.run_type == 3 /}
					<p>B2C零售商城</p>
					{else /}
					{/if}
				</div>
				<div class="">
				{if $vo.auth_status == -2 }
					<span>未通过</span>
				{elseif $vo.auth_status == -1 /}
					<span>已关闭</span>
				{elseif $vo.auth_status == 0 /}
					<span>审核中</span>
				{elseif $vo.auth_status == 1 /}
					<span>建设中</span>
				{elseif $vo.auth_status == 2 /}
					<span>营业中</span>
				{else /}
				{/if}
				</div>
			</li>
			{/volist}
			{/notempty}
		</ul>
		<div class="error_tipc"></div>
		<a href="javascript:void(0);" class="next-step step">下一步</a>
	</div>
	<div class="database-item hide">
		<ul class="goods-database-content" id="listLayer">

		</ul>
	</div>
</section>
<article class="f24">
	<section class="top_nav_fixed">
		<div class="top_bar columns_flex l-r-sides">
			<div class="">
				<a class="home">首页</a>
			</div>
			<div class="">
				<img src="http://msy.new.com/static/common/img/default/no_pic_40.jpg" alt="">
				<span>爱国宾</span>
			</div>
			<div class="">
				<a class="switch-account">切换我的店铺</a>
			</div>
		</div>
	</section>
	<section class="columns_flex l-r-sides">
		<div>
			<img class="left" src="http://msy.new.com/static/common/img/default/no_pic_40.jpg" alt="">
			<div>
				<p><span>某某</span>官方旗舰店</p>
				<p>B2B采购商城 <span>供应商自营</span></p>
			</div>
		</div>
		<div>
			<a href="" class="personal_center">我的</a>
			<a href="" class="my-store">我的店铺</a>
		</div>
	</section>
	<section class="bottomLine">
		<nav class="columns_flex channel_nav manufacturer_nav">
			<a href="">
				店铺提醒
			</a>
			<a href="" class="current">
				店铺管理
			</a>
			<a href="">
				营销推广
			</a>
			<a href="">
				官方活动
			</a>
		</nav>
	</section>
	<section class="specific_type store-manage-type bottomLine">
		<div class="columns_flex f20">
			<a >设置</a>
			<a class="column_type current">商品</a>
			<a href="{:url('Goods/setSort')}">排序</a>
			<a href="{:url('Goods/setInventory')}">入仓</a>
			<a href="{:url('Goods/setShelf')}">上架</a>
			<a>卡券</a>
		</div>
	</section>
	<section class="bottomLine">
		<div class="columns_flex backups-content ">
			<div>
				<span class="func-icons"></span>
				<span>功能推荐</span>
			</div>
			<div class="backups-right">
				<a href="javascript:void(0);" class="gr backup">备份本店铺商品数据</a>
				{notempty name="selfStore"}
				<p>上次备份日期:<span class="backup-time">{$selfStore.backup_time}</span></p>
				{else /}
				<p>上次备份日期:<span class="backup-time">从未备份</span></p>
				{/notempty}
				<a href="javascript:void(0);" class="gr copy-store">复制商品数据到本店铺</a>
			</div>
		</div>
	</section>
	<section>
		<div class="content-wrapper">
			<ul class="columns_flex flex-both-side" id="list">
			</ul>
		</div>
	</section>
</article>
<a href="{:url('goods/edit')}" class="increase-commodity foot-btn f24">增加商品</a>
{/block}
{block name="common"}
{include file="template/loading.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript" src="factory_js/getGoodsList.js"></script>
<script type="text/javascript">
	$(function () {
		var config = {
			pageSize:4,
			pageType:'manage',
		};
		var url = module+'goods/getList';
		//初始化商品列表
		getPage(url,config);
		//上拉加载更多
		getMore(url,config);

		var databaseContent=$('#databaseContent').html();
		$('body').on('click','.copy-store,.databaseLayer .goods-database-nav li:eq(0)',function(){
			var _this=$(this);

			layer.open({
				title:['复制商品数据到本店铺','border-bottom:1px solid #d9d9d9;'],
				className:'databaseLayer',
				content:databaseContent,
				success:function(){
					var oLi=$('.databaseLayer .goods-database-nav li:eq(0)')
					if(oLi.hasClass('current')){
						oLi.addClass('disabled');
					}
				}
			})
		});
		$('body').on('click','.next-step',function(){
			var _this=$(this);
			var oLi = $('.databaseLayer .goods-store-content li');
			var storeId  = $('.databaseLayer .goods-store-content li.current').data('store-id');
			if(oLi.hasClass('current')){
				layer.open({
					title:['复制商品数据到本店铺','border-bottom:1px solid #d9d9d9;'],
					className:'databaseLayer',
					content:databaseContent,
					success:function(){
//						$('.databaseLayer .goods-database-nav li:eq(0)').removeClass('disabled');
						if(_this.hasClass('step')){
							$('.databaseLayer .goods-database-nav li').eq(1).addClass('current').siblings().removeClass('current');
							$('.databaseLayer .database-item').hide().eq(1).show();
						}
						var url = module + 'Goods/getBackup';
						var config = {
							storeId:storeId,
							pageSize:4,
							page:4,
						};
						getPageLayer(url,config);
						var config1 = {
							storeId:storeId,
							pageSize:4,
						};
						getMoreLayer(url,config1)
					},
					yes:function(index){
						layer.close(index);
					},
					btn:['确定']
				})
			}else{
				errorTipc('请选择源文件');
			}
		});
		$('body').on('click','.databaseLayer .goods-store-content li',function(){
			var _this=$(this);
				_this.addClass('current').siblings().removeClass('current');
				_this.parent().siblings().find('li').removeClass('current');
		});
		$('body').on('click','.databaseLayer .goods-database-content li',function(){
			var _this=$(this);
				_this.toggleClass('current');
		})
		

		//备份
		$('body').on('click','.backup',function () {
			$.post(module+'Goods/backup',{},function (msg) {
				if(msg.status == 0){
					dialog.error(msg.info);
					return false;
				}
				console.log(msg);
				$('.backup-time').text(msg.create_time);
				dialog.success(msg.info);
			})
		});

	});
</script>
{/block}