{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="factory_css/main.css">
{/block}
{block name="content"}
<article class="f24">
	{include file="public/store_operation_head" /}
	<section class="bottomLine">
		<nav class="columns_flex channel_nav manufacturer_nav">
			<a href="javascript:void(0);">
				店铺提醒
			</a>
			<a href="{:url('Goods/manage')}" class="current">
				店铺管理
			</a>
			<a href="{:url('Promotion/manage')}">
				营销推广
			</a>
			<a href="javascript:void(0);">
				官方活动
			</a>
		</nav>
	</section>
	<section class="specific_type store-manage-type bottomLine">
		<div class="columns_flex f20">
			<a >设置</a>
			<a class="" href="{:url('Goods/manage')}">商品</a>
			<a href="{:url('Goods/setSort')}">排序</a>
			<a href="{:url('Goods/setInventory')}">入仓</a>
			<a class="column_type current">上架</a>
			<a>卡券</a>
		</div>
	</section>
	<section class="">
		<div class="content-wrapper">
			<ul class="columns_flex flex-both-side" id="list">
			</ul>
		</div>
	</section>

</article>
<!--<a href="{:url('goods/edit')}" class="increase-commodity foot-btn f24">增加商品</a>-->
{/block}
{block name="common"}
{include file="template/loading.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}
<script type="text/javascript" src="factory_js/getGoodsList.js"></script>
<script type="text/javascript">
	$(function () {

		//没有默认店铺
		var notDefaultStore = "{$notDefaultStore|default=0}";
		console.log(notDefaultStore);
		if(notDefaultStore == 0){
			//初始化商品列表
			var config = {
				pageSize:4,
				pageType:'shelf',
			};
			var url = module+'goods/getList';
			getPage(url,config);
			//上拉加载更多
			getMore(url,config);
		}


		//上下架
		$('body').on('click','.shelf',function(){
			var shelfStatus=$(this).data('shelf');
			var _this = $(this);
			var storeType=$('.channel_nav a.current').data('type');
			var goodsId = $(this).parents('li').data('id');
			var postData ={};
			postData.goodsId = goodsId;
			postData.shelf_status = shelfStatus;
			postData.storeType = storeType;
			var url = module+'goods/setShelf';
			$.ajax({
				url: url,
				data: postData,
				type: 'post',
				dataType:'json',
				beforeSend: function(){
				},
				error:function (xhr) {
					dialog.error('AJAX错误');
				},
				success: function(data){
					if(data.status == 1){
						if(shelfStatus==2){
							_this.removeClass('shelf').addClass('apply-shelf').text('已申请');
						}else{
							_this.data('shelf',2);
							_this.addClass('up-shelf').text('上架');
						}
					}
				}
			});
		})
	});
</script>
{/block}