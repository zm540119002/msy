{extend name="template/base.html" /}
{block name="css-customize"}
<link rel="stylesheet" href="store_css/main.css">
{/block}
{block name="content"}
<section class="f20">
	<h2 class="address_list_title">收货地址列表</h2>
</section>
<article class="f24">
	<section class="delivery_address">
		<input type="hidden" value="{$orderId}" class="order_id">
		{volist name="addressList" id="vo"}
			<div class="item_addr">
				<div class="ia-l"></div>
				<div class="item_info">
					<input type="hidden" value="{$vo.id}" class="address_id">
					<div class="mt_new">
						<span>{$vo.consignee}</span>
						<span>{$vo.mobile}</span>
						{if $vo.is_default eq 1 }
						<i class="default_tipc">默认</i>
						{/if}
					</div>
					<p class="">{$vo.district_address}{$vo.detail_address}</p>
				</div>
				<a href="javascript:void(0)" class="address_delete">删除</a>
				<a href="javascript:void(0);" class="ia-r address_delete">
					<span class="iar-icon"></span>
				</a>
			</div>
		{/volist}
	</section>
</article>
{/block}
{block name="common"}
{include file="template/footer_menu.html" /}
{/block}
{block name="footer"}{/block}
{block name="script"}

<script type="text/javascript">
	$(function(){
		$.each($('.delivery_address .item_info'),function(){
			var _This=$(this);
			_This.on('click',function(){
				_This.parents('.item_addr').addClass('active').siblings().removeClass('active');
				return false;
			})

		});

		//新建地址
		$('body').on('click','.address_create',function () {
			location.href = module + 'Address/edit';
		});

		//跳转到地址列表
		$('.item_info').click(function () {
			var addressId = $(this).find('.addressId').val();
			var orderId = $(this).parents().find('.orderid').val();
			if(orderId){
				location.href = module + '/Order/orderDetail/orderId/'+orderId+'/addressId/'+addressId;
			}
		});

		//修改地址
		$('body').on('click','.address_edit',function () {
			var addressId = $(this).parent().find('.addressId').val();
			var url = CONTROLLER + '/addAddress/addressId/'+addressId;
			var orderId = $(this).parents().find('.orderid').val();
			if(orderId){
				url += '/orderId/'+orderId;
			}
			location.href = url;
		});

		//删除地址
		$('body').on('click','.address_delete',function () {
			var _this=$(this);
			var addressId = _this.siblings().find('.addressId').val();
			layer.open({
				content : '删除你选中的地址吗',
				time:5,
				btn : ['是','否'],
				title: '提示',
				yes : function(index){
					$.post(CONTROLLER+'/delAddress',{addressId:addressId},function (msg) {
						if(msg.status == 1){
							_this.parents('.item_addr').remove();
						}
						if(msg.status == 0){
							dialog.error(msg.info);
						}
					});
					layer.close(index);
				}
			});

		})
	});
</script>
{/block}