<template id="city_picker_tpl">
    <div class="city_picker">
        <section class="express-area-box" style="bottom: 0px;">
            <header>
                <h3>选择地区</h3>
                <a href="javascript:void(0);" class="backUp" title="返回" v-show="!displayProvince" @click="backUp"></a>
                <a href="javascript:void(0);" class="close" title="关闭" @click="close"></a>
            </header>
            <article id="areaBox">
                <ul id="provinceList" class="area-list" v-if="displayProvince">
                    <li v-for="province in provinces" :code="province.code" @click="updateCity">{{province.name}}</li>
                </ul>
                <ul id="cityList" class="area-list" v-else>
                    <li v-for="city in cities" :code="city.code">{{city.name}}</li>
                </ul>
            </article>
        </section>
        <div class="address_mask city_mask" @click="close"></div>
    </div>
</template>
<script type="text/javascript">
    $(function(){
        //城市选择
        Vue.component('city_picker', {
            template:'#city_picker_tpl',
            props: {
                type: {type: Number,default: 1},
                init_provinces: {
                    type: Object,
                    default: function () {
                        return {}
                    }
                }
            },data: function () {
                return {
                    provinces: this.init_provinces.provinces, //所有省份
                    cities:[], //被选择的省对应的市数据
                    postData:{
                        selectedProvince: '', //被选择的省
                        selectedCity:'',  //被选择的市
                        selectedCityLevel:''  //被选择的市的级别
                    },
                    displayProvince: {type: Boolean,default: true}
                }
            },methods: {
                //更新市数据
                updateCity:function(event){
                    let _thisJquery = $(event.currentTarget);
                    let _this = this;
                    _this.postData.selectedProvince = _thisJquery.attr('code');
                    _this.provinces.map(function(item,index){
                        if(item.code == _this.postData.selectedProvince){
                            _this.cities = item.cities;
                        }
                    });
                    if(_this.cities.length){
                        _this.postData.selectedCity = _this.cities[0].code;
                        _this.postData.selectedCityLevel = _this.cities[0].level;
                    }
                    this.displayProvince = false;
                },backUp:function(){
                    let _this = this;
                    this.displayProvince = true;
                },close:function(){
                    let _this = this;
                    console.log(_this.$parent.$data);
                    _this.$parent.display = false;
//                    let _thisJquery = $(event.currentTarget);
//                    _thisJquery.parents('div.city_picker').hide();
                },created:function(){
                    let _this = this;
                }
            }
        });
    });
</script>
<style scoped>
</style>