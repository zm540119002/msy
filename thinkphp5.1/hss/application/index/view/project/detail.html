{extend name="template/base.html" /}

{block name="title"}
项目详情
{/block}

{block name="content"}
<article class="f24">
	<!-- 项目信息 -->
	<div id="menu">
		<ul class="columns_flex detail-nav">
			<li data-item="item1"><a href="javascript:;" class="">项目产品</a></li>
			<li data-item="item2"><a href="javascript:;" class="">项目详情</a></li>
			<li data-item="item3"><a href="javascript:;" class="">项目操作</a></li>
		</ul>
	</div>

	<!-- 项目产品 -->
	<section class="content-padding content_main project_item">

		{include file="template/scene_detail.html" /}

		<!-- 内容 -->
		<section class="content-padding content_main wy_list">
			<!--采购方案列表-->
			{notempty name="promotionList"}
			{volist name="promotionList" id="vo"}
			<a href="{:url('Promotion/detail',['id'=>$vo.id])}" data-id="{$vo.id}" class="">
				<div class="applay_p_item columns_flex l-r-sides">
					<div>
						<div>¥<price>{$vo.price}</price></div>
						<p>{$vo.title}</p>
						<p>立即进入</p>
					</div>
					<div class="group_btn50">
						<img class="common_default_img" src="{:show_img_handle($vo.thumb_img)}" alt="{$vo.name}">
					</div>
				</div>
			</a>
			{/volist}
			{/notempty}
			<!--产品列表-->
			<ul class="goods_list list" id="list">
				<div id="product-select">
					<product-select
							v-for="productInfo in productList"
							:key="productInfo.id"
							:product_id="productInfo.id"
							:deal_price="parseFloat(productInfo.bulk_price)"
							:product_name="productInfo.headline"
							:product_src="productInfo.thumb_img"
							:product_url="String(productInfo.id)"
							:buy_named="buy_named"
							:init_quantity="parseInt(init_quantity)"
							:step_quantity="parseInt(step_quantity)"
							:display_pic="display_pic"
					></product-select>
				</div>
			</ul>
		</section>
	</section>
	<!-- 项目详情 -->
	<section class="project_item hide">
		<p>
			<img src="{:show_img_handle($project.main_img)}" alt="">
		</p>
	</section>
	<!-- 项目操作 -->
	<section class="project_item hide">

		{notempty name="$project.video"}
		<div class="content-padding">
			<video width="" height="" controls src="{:show_img_handle($project.video)}">
			</video>
			<p>{$project.name}项目培训</p>
			<p>{$project.update_time}</p>
		</div>
		{/notempty}
		<div>
			<h3>相关视频</h3>
			<ul class="p_video_item" id="videos">

			</ul>
		</div>
	</section>
</article>
{/block}
{block name="common"}
	{include file="../../api/public/vue/components/footer-cart-menu.html" /}
{/block}
{block name="footer"}
<div id="foot_cart_menu">
	<footer-cart-menu
			:add_cart_call_back="add_cart_call_back"
	></footer-cart-menu>
</div>
{/block}
{block name="script"}
<script type="text/javascript" src="api_common_js/swiper.min.js"></script>
<script type="text/javascript">
	function getJsonCallBack(data){
		console.log(data);
		param = {
			'buy_named':'采购数量',
			'display_quota':true,
			'display_pic':true,
			'init_quantity':2,
			'step_quantity':10,
			'productList':data.data
		};
		new Vue({
			el: '#product-select',
			data:function(){
				return param;
			}
		});
	}
	// 获取该场景下的商品
	var config = {
		url:module+'Goods/getRelationGoods',
		requestEnd:false,
		loadTrigger:false,
		currentPage:1,
		callBack:getJsonCallBack
	};
	var postData = {
		pageSize:10,
		relation:'{$relation}'
	};
	$(function(){
		//初始化场景商品页面
		postData.id = '{$info.id}';
		getJsonList(config,postData);
		let param = {
		};
		new Vue({
			el: '#foot_cart_menu',
			data:function(){
				return param;
			},methods: {
				add_cart_call_back:function (param) {
					let goodsList = {};
					console.log(param);
				}
			}
		});
	});
	$(function(){
		var id = '{$info.id}';
		var date=getWeek();
		countDown(date,$('#countDownBox'));
		// 后加载简介
		$('document').ready(function(){
			$('.intro').html("{$info.intro|raw}");
		});
		//轮播
		var swiper = new Swiper('.swiper-container', {
			spaceBetween: 30,
			autoplay:true,
			pagination: {
				el: '.swiper-pagination',
				clickable: true
			}
		});

		// 项目信息切换
		$('.detail-nav li').on('click',function(){
			$(this).addClass('current').siblings().removeClass('current');
			$('.project_item').hide().eq($(this).index()).show();
		})
	});
</script>
{/block}