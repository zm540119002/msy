<section id="userLoginForm" style="display:none;">
    <div class="f24">
        <div class="ucenter_logo">
            <img src="PUBLIC_IMG/common/ucenter_logo.png" alt="">
            <p>已注册用户通行证登陆</p>
        </div>
        <ul class="loginNav">
            <li class="current">账号密码登录</li>
            <li>短信验证码登陆</li>
        </ul>
        <form class="loginTab" id="formLogin">
            <div class="userLogin login_wrap active">
                <div class="login_item">
                    <span class="username_txt">账号</span>
                    <input class="username user_name" type="text" placeholder="6-16位数字、字母或下划线" name="name">
                </div>
                <div class="login_item">
                    <span class="password_txt">密码</span>
                    <input class="username password" type="password" placeholder="6-16数字或字母" name="password">
                </div>
            </div>
            <div class="smsLogin login_wrap hide">
                <div class="login_item">
                    <span class="username_txt">手机号</span>
                    <input class="username user_phone" type="tel" placeholder="请输入手机号" name="mobile_phone">
                    <a href="javascript:void(0);" class="mesg_code">获取验证码</a>
                </div>
                <div class="login_item">
                    <span class="username_txt txt3">验证码</span>
                    <input type="text" class="tel_code username input_txt3" placeholder="请输入收到的验证码" name="captcha">
                </div>
            </div>
            <input type="hidden" name="captcha_type" value="login" />
        </form>
        <div class="error_tipc" ></div>
        <div class="friend_tipc">
            <a href="javascript:void(0);" class="register_dialog">注册</a>
            <a href="javascript:void(0);" class="forget_dialog">忘记美尚通行证密码?重置密码</a>
        </div>
    </div>
</section>
<script type="text/javascript">
    var userLoginForm=$('#userLoginForm').html();
    //登录触发
    var loginLayer = null;
    function loginDialog(func){
        window.scrollTo(0,0);
        loginLayer = layer.open({
            className:'loginLayer',
            content:userLoginForm,
            btn:'登录',
            success:function(){
                tab_down('.loginNav li','.loginTab .login_wrap','click');
                $('.layui-m-layershade').on('touchmove',function(e){
                    event.preventDefault(); 
                });
            },
            yes:function(index){
                var $layer = $('.loginLayer').find('.active');
                var _index =$('.loginLayer').find('.login_wrap.active').index();
                var content='';
                //验证
                switch(_index){
                    case 0:
                        var userName=$layer.find('.user_name').val();
                        var password=$layer.find('.password').val();
                        if(!checkAccount(userName)){
                            content='请输入正确用户名';
                        }else if(!register.pswCheck(password)){
                            content = "请输入6-16数字或字母的密码";
                        }
                        break;
                    case 1:
                        var userPhone=$layer.find('.user_phone').val();
                        var verifiCode=$layer.find('.tel_code').val();
                        if(!register.phoneCheck(userPhone)){
                            content='请输入正确手机号';
                        }else if(!register.vfyCheck(verifiCode)){
                            content = "请输入正确的验证码";
                        }
                        break;
                }
                if(content){
                    errorTipc(content);
                    return false;
                }

                var url = '{:U("/Home/User/login")}';
                var postData = $('.loginLayer').find('#formLogin').serializeObject();
                $.ajax({
                    url:url,
                    type:'post',
                    data:postData,
                    error:function(xhr){},
                    success:function(data){
                        if(data.status==0){
                            errorTipc(data.info);
                            return false;
                        }else if(data.status==1){
                            if(func && $.isFunction(func)){
                                func();
                            }
                            layer.close(index);
                        }
                    }
                });
            }
        });
    };
    
    $(function(){
        //注册
        $('body').on('click','.register_dialog',function(){
            platformNotesDialog();
            //registerDialog();
        });

        //忘记密码
        $('body').on('click','.forget_dialog',function(){
            forgetPasswordDialog();
        });
        
    });
</script>
