<extend name="Public:base" />

<block name="css-customize">
    <link type="text/css" rel="stylesheet" href="PUBLIC_ADMIN_CSS/common/fenlei.css" />
    <link type="text/css" rel="stylesheet" href="PUBLIC_ADMIN_CSS/common/skin.css" />
</block>

<block name="content">
    <div class="page">
        <div class="fixed-bar">
            <div class="item-title">
                <ul class="tab-base">
                    <li><a href="{:U('Goods/goodsManage')}" ><span>管理</span></a></li>
                    <li><a href="{:U('Goods/goodsBaseEdit')}" class="current"><span>编辑</span></a></li>
                </ul>
            </div>
        </div>
        <div style="margin-top:15px;">
            <form id="form1">
                <table id=table18 class="add_new_merchandise" border=0 cellspacing=1 width="100%" height=57>
                    <tbody>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>商品主图：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <p>
                                <input type="file" class="upload" id="img">
                                <label class="uploadbtn" for="img" title="JPG,GIF,PNG"></label>
                            </p>
                            <p class="showimg" id="showimg">图片上传大小请小于50k</p>
                            <empty name="goodsBaseInfo.main_img">
                                <img class="img" src="PUBLIC_ADMIN_IMG/common/default/goods_default.png">
                                <else />
                                <img class="img main_img" src="UPLOADS_IMG/{$goodsBaseInfo.main_img}">
                            </empty>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>缩略图：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <p>
                                <input type="file" class="upload" id="">
                                <label class="uploadbtn" for="img" title="JPG,GIF,PNG"></label>
                            </p>
                            <p class="showimg" >图片上传大小请小于50k</p>
                            <empty name="goodsBaseInfo.thumb_img">
                                <img class="img" src="PUBLIC_ADMIN_IMG/common/default/goods_default.png">
                                <else />
                                <img class="img thumb_img" src="UPLOADS_IMG/{$goodsBaseInfo.thumb_img}">
                            </empty>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>所属分类：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <include file="Public/categoryLinkage"/>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>商品名称：</td>
                        <td class=dotted_bottom_gray width="40%" align=left>
                            <input style="width: 200px; " class="inputboxadmin" name="name" value="{$goodsBaseInfo.name}">
                            <input type="hidden" name="goodsBaseId" value="{$goodsBaseInfo.id}">
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>商品零售价：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 200px; " class="inputboxadmin" name="price" value="{$goodsBaseInfo.price}">
                        </td>
                    </tr>

                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>单品规格：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 200px; " class="inputboxadmin" name="single_specification" value="{$goodsBaseInfo.single_specification}">
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>包装数量：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 200px; " class="inputboxadmin" name="package_num" value="{$goodsBaseInfo.package_num}">
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>包装单位：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <select name="package_unit" class="selectbox">
                                <notempty name="unitList">
                                    <volist name="unitList" id="vo">
                                        <option value="{$vo.key}">{$vo.value}</option>
                                    </volist>
                                </notempty>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right><font color="#FF0000">*</font>采购单位：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <select name="purchase_unit" class="selectbox">
                                <notempty name="unitList">
                                    <volist name="unitList" id="vo">
                                        <option value="{$vo.key}">{$vo.value}</option>
                                    </volist>
                                </notempty>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>商品库存：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 200px; " class=inputboxadmin name="inventory"  value="{$goodsBaseInfo.inventory}" >
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>排序：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 100px; " class="inputboxadmin" name="sort" value="{$goodsBaseInfo.sort}">
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>标签：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <input style="width: 200px; " class="inputboxadmin" name="tag" value="{$goodsBaseInfo.tag}">
                            多个标签请用逗号分隔，例如：正品保障,纳晶水光
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>商品简介：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <!-- 加载编辑器的容器 -->
                            <script id="intro" type="text/plain">
                                {$goodsBaseInfo.intro|htmlspecialchars_decode}
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>商品参数：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <script id="param" type="text/plain">
                                {$goodsBaseInfo.param|htmlspecialchars_decode}
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>商品详情图：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                             <script id="detail" type="text/plain">
                                {$goodsBaseInfo.detail_img|formatImg}
                            </script>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>使用说明：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <script id="usage" type="text/plain">
                                {$goodsBaseInfo.usage|htmlspecialchars_decode}
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <td class=dotted_bottom_gray height=40 width="11%" align=right>注意事项：</td>
                        <td class=dotted_bottom_gray width="89%" align=left>
                            <script id="notices" type="text/plain">
                                {$goodsBaseInfo.notices|htmlspecialchars_decode}
                            </script>
                        </td>
                    </tr>
                    <tr>
                        <td width="11%"></td>
                        <td height=60 width="50%" align=center>
                            <a href='javascript:void(0);'><input class="button_save_black_4" value="确定" type="button"></a>
                            &nbsp;&nbsp;
                            <input class="button_save_black" name="add0" value="返回" type="button">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </form>
        </div>
    </div>
</block>
<block name="script">
    <!-- 配置文件 -->
    <script type="text/javascript" src="PUBLIC_ADMIN_JS/common/Ueditor/ueditor.config.js"></script>
    <!-- 编辑器源码文件 -->
    <script type="text/javascript" src="PUBLIC_ADMIN_JS/common/Ueditor/ueditor.all.js"></script>
    <script type="text/javascript" charset="utf-8" src="PUBLIC_ADMIN_JS/common/Ueditor/lang/zh-cn/zh-cn.js"></script>
    <script src="http://cdn.bootcss.com/html5media/1.1.8/html5media.min.js"></script>
    <!-- 实例化编辑器 -->
    <script type="text/javascript">
        var ueIntro = UE.getEditor('intro');
        var ueParam = UE.getEditor('param');
        var ueDetail = UE.getEditor('detail');
        var ueUsage = UE.getEditor('usage');
        var ueNotices = UE.getEditor('notices');
    </script>
    <script type="text/javascript" src="PUBLIC_ADMIN_JS/common/categoryLinkage.js"></script>
    <script type="text/javascript" src="PUBLIC_ADMIN_JS/common/uploadImgToTemp.js"></script>
    <script type="text/javascript">
        $(function(){

            //页面初始化
            var category_id_1 = '{$goodsBaseInfo.category_id_1}';
            if(category_id_1){
                $('[name=category_id_1]').val(category_id_1);
                $('[name=category_id_1]').change();
            }
            var category_id_2 = '{$goodsBaseInfo.category_id_2}';
            if(category_id_2){
                $('[name=category_id_2]').val(category_id_2);
                $('[name=category_id_2]').change();
            }
            var category_id_3 = '{$goodsBaseInfo.category_id_3}';
            if(category_id_3){
                $('[name=category_id_3]').val(category_id_3);
            }
            var package_unit = '{$goodsBaseInfo.package_unit}';
            if(package_unit){
                $('[name=package_unit]').val(package_unit);
            }

            //确定
            $('.button_save_black_4').on('click',function(){
                var postData = $('#form1').serializeObject();
                if($('input[name=discount]').is(":checked")){
                    postData.buy_type = $('input[type="radio"]:checked').data('buy_type');
                }
                //主图
                postData.main_img = $(".main_img").attr('src');
                postData.thumb_img = $(".thumb_img").attr('src');
                //详情图
                postData.detail_img = '';
                $.each($('iframe').contents().find('.view img'),function () {
                    postData.detail_img += $(this).attr('src') + ',';
                });
                //简介
                postData.intro = ueIntro.getContent();
                postData.param = ueParam.getContent();
                postData.usage = ueUsage.getContent();
                postData.notices = ueNotices.getContent();
                $.post(ACTION,postData,function(msg){
                    dialog.msg(msg,'',function () {
                        location.href = CONTROLLER + '/goodsManage';
                    });
                },'JSON');
            });


            //返回
            $('.button_save_black').click(function(){
                location.href = CONTROLLER + '/goodsManage';
            });
        });
    </script>
</block>