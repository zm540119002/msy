<extend name="Public:base" />

<block name="css-customize">
    <link rel="stylesheet" type="text/css" href="PUBLIC_CSS/home/mall.css">
</block>
<block name="nav">编辑收货地址</block>
<block name="content">
    <section class="f20">
        <empty name="address">
            <h2 class="address_list_title">新建收货地址</h2>
            <else />
            <h2 class="address_list_title">编辑收货地址</h2>
        </empty>
    </section>
    <section class="section-address bg-eae pt-5">
        <form action='#' method="post" class="bg-fff form">
            <input type="hidden" name="addressId" value="{$address.id}">
            <input type="hidden" name="orderId" value="{$orderId}">
            <div class="form-group box-flex clearfixed">
                <label class="form-label">收件人：</label>
                <input type="text" name="consignee" class="input-flex recipient_name" placeholder="请输入姓名" value="{$address.consignee}">
            </div>
            <div class="form-group box-flex clearfixed">
                <label class="form-label">联系电话：</label>
                <input type="text" name="mobile" class="input-flex recipient_mobile" placeholder="请输入收件人电话" value="{$address.mobile}">
            </div>

            <div class="express-area ">
                <a id="expressArea" href="javascript:void(0)" class="f24 form-group box-flex">
                    <label class="form-label">选择地区：</label>
                    <empty name="address">
                        <div class="area_address">省 &gt; 市 &gt; 区/县</div>
                        <else />
                        <div class="area_address">{$address.district}</div>
                    </empty>
                    <input type="hidden" value="{$address.district}" class="district_address">
                </a>
            </div>
            <div class="form-group box-flex">
                <label class="form-label">详细地址：</label>
                <input type="text" name="address" class="input-flex recipient_detail_address" placeholder="请填写详细地址" value="{$address.address}">
            </div>
            <if condition="$address.is_default eq 1 ">
                <else />
                <div class="set_default_item f24">
                    <div>
                        <span>设为默认地址</span>
                        <p>注：每次下单时会使用该地址</p>
                    </div>
                    <div class="myswitch"  data-off="{$address.is_default}"></div>
                </div>
            </if>

        </form>
    </section>
    <!--选择地区弹层-->
    <section id="areaLayer" class="express-area-box" style="display:none;">
        <header>
            <h3>选择地区</h3>
            <a id="backUp" class="back" href="javascript:void(0);" title="返回" style="display: none;"></a>
            <a id="closeArea" class="close" href="javascript:void(0);" title="关闭"></a>
        </header>
        <article id="areaBox">
            <ul id="areaList" class="area-list">
                <!--<li onclick="selectP(0);">北京市</li><li onclick="selectP(1);">天津市</li><li onclick="selectP(2);">河北省</li><li onclick="selectP(3);">河南省</li><li onclick="selectP(4);">山西省</li><li onclick="selectP(5);">山东省</li><li onclick="selectP(6);">内蒙古自治区</li><li onclick="selectP(7);">辽宁省</li><li onclick="selectP(8);">吉林省</li><li onclick="selectP(9);">黑龙江省</li><li onclick="selectP(10);">上海市</li><li onclick="selectP(11);">江苏省</li><li onclick="selectP(12);">浙江省</li><li onclick="selectP(13);">福建省</li><li onclick="selectP(14);">江西省</li><li onclick="selectP(15);">安徽省</li><li onclick="selectP(16);">湖北省</li><li onclick="selectP(17);">湖南省</li><li onclick="selectP(18);">广东省</li><li onclick="selectP(19);">广西壮族自治区</li><li onclick="selectP(20);">海南省</li><li onclick="selectP(21);">重庆市</li><li onclick="selectP(22);">四川省</li><li onclick="selectP(23);">贵州省</li><li onclick="selectP(24);">云南省</li><li onclick="selectP(25);">西藏自治区</li><li onclick="selectP(26);">陕西省</li><li onclick="selectP(27);">甘肃省</li><li onclick="selectP(28);">青海省</li><li onclick="selectP(29);">宁夏回族自治区</li><li onclick="selectP(30);">新疆维吾尔自治区</li><li onclick="selectP(31);">台湾省</li><li onclick="selectP(32);">香港特别行政区</li><li onclick="selectP(33);">澳门特别行政区</li>-->
            </ul>
        </article>
    </section>
    <!--遮罩层-->
    <div id="areaMask" class="address_mask"></div>
</block>
<block name="footer">
    <include file="Cart/footerCartMenu" />
</block>
<block name="js-customize">
    <script src="PUBLIC_JS/common/jquery.area.js"></script>
</block>
<block name="script">
    <script type="text/javascript">
        $(function () {
            //设定默认地址
            $('.myswitch').on('click',function(){
            if($(this).hasClass('myswitched')){
                $(this).removeClass('myswitched');
                $(this).attr('data-off',0);
            }else{
                $(this).addClass('myswitched');
                $(this).attr('data-off',1);
            }
            });

            $('body').on('click','.address_save',function () {
                var content='';
                var recipientName=$('.recipient_name').val();
                var recipientMobile=$('.recipient_mobile').val();
                var areaAddress=$('.district_address').val();
                console.log(areaAddress);
                var detailAddress=$('.recipient_detail_address').val();
                if(!recipientName){
                    content='请填写收货人姓名';
                }else if(!register.phoneCheck(recipientMobile)){
                    content='请填写正确的手机号码';
                }else if(!areaAddress){
                    content='请选择地区';
                }else if(!detailAddress){
                    content='请填写详细地址';
                }

                if(content){
                    dialog.error(content);
                    return false;
                }
                //添加或修改地址
                var is_default      = $('.myswitch').attr('data-off');
                var postData        = $(".form").serializeObject();
                postData.district   = areaAddress;
                postData.is_default = is_default;
                var url = MODULE + '/Order/orderDetail/';
                $.post(CONTROLLER+'/addAddress',postData,function (msg) {
                    if(msg.status == 1){
                        var addressId = msg.data;
                        if(postData.orderId){
                            url += 'addressId/'+addressId+'/orderId/'+postData.orderId;
                            location.href = url;
                        }else{
                            dialog.success(msg.message,CONTROLLER + '/addressList');
                        }
                }
                if(msg.status == 0){
                    dialog.error(msg.info);
                }
                },'json')
            })
        })
    </script>

</block>