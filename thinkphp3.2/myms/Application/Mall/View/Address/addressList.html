<extend name="Public:base" />

<block name="css-customize">
    <link rel="stylesheet" type="text/css" href="PUBLIC_CSS/home/mall.css">
</block>
<block name="nav">收货地址列表</block>
<block name="content">
    <section class="f20">
        <h2 class="address_list_title">收货地址列表</h2>
    </section>
    <article class="f24">
        <section class="delivery_address">
            <input type="hidden" value="{$cartIds}" class="cartIds">
            <input type="hidden" value="{$goodsId}" class="goodsId">
            <input type="hidden" value="{$projectId}" class="projectId">
            <volist name="addressList" id="vo">
            <div class="item_addr">
                <div class="ia-l"></div>
                <div class="item_info">
                    <input type="hidden" value="{$vo.id}" class="addressId">
                    <div class="mt_new">
                        <span>{$vo.consignee}</span>
                        <span>{$vo.mobile}</span>
                        <if condition="$vo.is_default eq 1 ">
                        <i class="default_tipc">默认</i>
                        </if>
                    </div>
                    <p class="">{$vo.district}{$vo.address}</p>
                </div>
                <a href="javascript:void(0)" class="delete_address">删除</a>
                <a href="javascript:void(0);" class="ia-r  editAddress">
                    <span class="iar-icon"></span>
                </a>
            </div>
            </volist>
        </section>
        <div class="pay-btn">
            <a href="javascript:void(0);" class="btn1 tip-btn addAddress"><i class="plus">+</i>新建地址</a>
        </div>
    </article>
</block>
<block name="js-customize">

</block>
<block name="script">
    <script type="text/javascript">
        $(function(){

            $.each($('.delivery_address .item_info'),function(){
                var _This=$(this);
                _This.on('click',function(){
                    _This.parents('.item_addr').addClass('active').siblings().removeClass('active');
                    return false;
                })

            });

            //跳转到地址列表
            $('.item_info').click(function () {
               var addressId = $(this).find('.addressId').val();
               var cartIds = $(this).parents().find('.cartIds').val();
               var goodsId = $(this).parents().find('.goodsId').val();
                var projectId = $(this).parents().find('.projectId').val();
                console.log(projectId);
                if(cartIds){
                   location.href = MODULE + '/Order/addOrder/cartIds/'+cartIds+'/addressId/'+addressId;
                }
                if(goodsId){
                    location.href = MODULE + '/Order/addOrder/goodsId/'+goodsId+'/addressId/'+addressId;
                }
                if(projectId){
                    location.href = MODULE + '/Order/addOrder/projectId/'+projectId+'/addressId/'+addressId;
                }
            });

            //新增地址
            $('.addAddress').click(function () {
                var cartIds = $(this).parents().find('.cartIds').val();
                var goodsId = $(this).parents().find('.goodsId').val();
                var projectId = $(this).parents().find('.projectId').val();
                var url = CONTROLLER + '/addAddress';
                console.log(projectId);
                if(cartIds){
                    url += '/cartIds/'+cartIds;
                }
                if(goodsId){
                    url += '/goodsId/'+goodsId;
                }
                if(projectId){
                    url += '/projectId/'+projectId;
                }
                location.href = url;
            });


            //修改地址
           $('body').on('click','.editAddress',function () {
               var addressId = $(this).parent().find('.addressId').val();
               var url = CONTROLLER + '/addAddress/addressId/'+addressId;
               var cartIds = $(this).parents().find('.cartIds').val();
               var goodsId = $(this).parents().find('.goodsId').val();
               var projectId = $(this).parents().find('.projectId').val();
               if(cartIds){
                   url += '/cartIds/'+cartIds;
               }
               if(goodsId){
                   url += '/goodsId/'+goodsId;
               }
               console.log(projectId);
               if(projectId){
                   url += '/projectId/'+projectId;
               }
               location.href = url;
           });

            //删除地址
            $('body').on('click','.delete_address',function () {
                var _this=$(this);
                var addressId = _this.siblings().find('.addressId').val();
                layer.open({
                    content : '删除你选中的地址吗',
                    time:5,
                    btn : ['是','否'],
                    title: '提示',
                    yes : function(index){
                       $.post(CONTROLLER+'/delAddress',{addressId:addressId},function (msg) {
                            if(msg.status == 1){
                               _this.parents('.item_addr').remove();
                            }
                           if(msg.status == 0){
                               dialog.error(msg.info);
                           }
                       });
                        layer.close(index);
                    }
                });

            })
        })
    </script>

</block>