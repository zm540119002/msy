<extend name="Public:base" />

<block name="css-customize">
    <link rel="stylesheet" type="text/css" href="PUBLIC_CSS/home/mall.css">
</block>
<block name="content">
    <div class="common_type_banner">
        <img src="PUBLIC_IMG/home/default/goods_default.png" alt="">
    </div>
    <div class="content common_contents"  ></div>
    <input type="hidden" value="1" class="page">
    <!-- 隐藏区 -->
    <div style="display:none">
        <div id="loading">
            <div class='loading'><img src='PUBLIC_IMG/home/loading.gif' alt='loading'></div>
        </div>
    </div>
</block>
<block name="script">

    <script type="text/javascript">

        var currentPage = 1;//记录当前页
        var requestEnd = false;//请求结束标记
        //获取商品-列表
        function getGoodsList(config) {
            var postData = $.extend({},config);
            postData.p = currentPage?currentPage:1;
            postData.pageSize = postData.pageSize?postData.pageSize:2;
            postData.templateType = postData.templateType?postData.templateType:'list';
            //请求结束标志
            if(requestEnd){
                dialog.error('没有更多啦');
                loadTrigger = true;
                return false;
            }
            $.ajax({
                url: MODULE + '/Goods/goodsList',
                data: postData,
                type: 'get',
                beforeSend: function(){
                    $('.loading').show();
                },
                error:function (xhr) {
                    $('.loading').hide();
                    dialog.error('AJAX错误');
                },
                success: function(data){
                    $('.loading').hide();
                    if($('.content >div>ul>li').length ){
                        $('.content >div>ul>li:last').after(data);
                    }else {
                        $('.content').html(data);
                    }
                    if($(data).find('li').length<postData.pageSize){
                        requestEnd = true;
                    }
                    currentPage ++;
                    loadTrigger = true;
                }
            });
        }
        //上拉加载更多
        var loadTrigger = false;//加载触发器
        $(window).on('scroll',function(){
            console.log(loadTrigger);
            if(loadTrigger && $(document).scrollTop()+$(window).height()>=$(document).height()){
                loadTrigger = false;
                getGoodsList(config);
            }
        });
        var config = {
            pageSize:6,
            position:'groupGoods'
        };
        $(function(){
            $(function(){
                //初始化
                getGoodsList(config);
            });

        });
    </script>

</block>

