<extend name="Public:base" />

<block name="css-customize">
    <link rel="stylesheet" type="text/css" href="PUBLIC_CSS/home/mall.css">
</block>
<block name="content">
    <!-- S= 轮播图 -->
   <section>
       <div>
           <notempty name="goodsInfo.main_img">
               <img data-img="" data-isloaded="" src="UPLOADS_IMG/{$goodsInfo.main_img}" alt="" class="c_img" />
               <else />
               <img data-img="" data-isloaded="" src="PUBLIC_IMG/home/default/goods_default.png" alt="" class="c_img" />
           </notempty>
       </div>
   </section>
    
    <div class="content common_contents"  ></div>
    <input type="hidden" class="goods_position" value="categoryGoods">

    <!-- 隐藏区 -->
    <div style="display:none">
        <div id="loading">
            <div class='loading'><img src='PUBLIC_IMG/home/loading.gif' alt='loading'></div>
        </div>
    </div>
    <block name="footer">
        <include file="Public/footerCartWithAdd" />
    </block>
</block>
<block name="js-customize">
    <script type="text/javascript" src="PUBLIC_JS/home/cart.js"></script>
</block>

<block name="script">
    <script type="text/javascript">
        /**
         * 继续加载
         * */
        var before_request = 1; // 上一次请求是否已经有返回来, 有才可以进行下一次请求
        var currentCatId = 0;
        function getMoreGoods(catId,type){
            var url = MODULE+'/Goods/goodsList';
            var getData = {};
            if(before_request == 0 && catId == currentCatId ){
                return false;
            }// 上一次请求没回来 不进行下一次请求
            if(catId != currentCatId || type == 1){
                page = 1;
            }
            before_request = 0;
            getData.pageSize = 4;
            getData.p = page++ ;
            getData.catId =  catId;

            $.ajax({
                type : 'get',
                data: getData,
                url:url,

                beforeSend: function(){
                    $('.content').append($('#loading').html());
                },

                success: function(data)
                {
                    if(data.status == 0){
                        dialog.error(data.info);
                        before_request = 0;
                    }else{
                        if(type == 1){
                            $('.content').html(data);
                        }else{
                            if($('.content >div>ul>li').length ){
                                $('.content >div>ul>li:last').after(data);
                            }else {
                                $('.content').html(data);
                            }
                        }
                        before_request = 1;
                    }

                    currentCatId = catId;
                },
                complete:function(){
                    $('.loading').remove();
                }
            });
        }

        $(function(){
            //初始化
            var categoryId = {$categoryId};
            getMoreGoods(categoryId);
             //下拉加载更多
            $(window).on('scroll',function(){
                if($(document).scrollTop()+$(window).height()>=$(document).height()){
                    getMoreGoods(categoryId);
                }
            });

            //滑动轮播
            var elem = document.getElementById('slider');
            window.mySwipe = Swipe(elem, {
                auto: 2500,
                callback: function(index,element){
                    //回调函数
                    $(".position li").eq(index).addClass("on").siblings().removeClass("on");
                }
            });
            $(".position li").click(
                    function () {
                        mySwipe.slide($(this).index());
                    }
            );
            tab_down('.common_top_nav li','.common_contents .common_tablist_wrap','click');

        });
    </script>

</block>
