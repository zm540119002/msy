<extend name="Public:base" />

<block name="css-customize">
    <link rel="stylesheet" type="text/css" href="PUBLIC_CSS/home/mall.css">
</block>
<block name="nav">提交订单</block>
<block name="content">
    <article class="f24 fill_order_wrapper">
        <notempty name="address">
            <section class="order_address">
                <div class="m step1-in ">
                    <a href="javascript:void(0);" class="s-href changeAddress">
                        <div class="mt_new">
                            <div class="s1-name">
                                <span id="address-name">{$address.consignee}</span>
                            </div>
                            <div class="s1-phone">
                                <span id="address-mobile">{$address.mobile}</span>
                            </div>
                        </div>
                        <div class="mc step1-in-con">
                            <i class="location-pic"></i>
                            <span id="address-where" class="address-where">{$address.district}{$address.address}</span>
                        </div>
                        <input type="hidden" id="addressId" value="{$address.id}">
                    </a>
                </div>
            </section>
            <else />
            <section class="section-address bg-eae pt-5">
                <form action='#' method="post" class="bg-fff address_form">
                    <input type="hidden" id="area_address" value="area_address">
                    <div class="form-group box-flex clearfixed">
                        <label class="form-label">收件人：</label>
                        <input type="text" name="consignee" class="input-flex recipient_name " placeholder="请输入姓名" value="">
                    </div>
                    <div class="form-group box-flex clearfixed">
                        <label class="form-label">联系电话：</label>
                        <input type="text" name="mobile" class="input-flex recipient_mobile" placeholder="请输入收件人电话" value="">
                    </div>
                    <div class="express-area ">
                        <a id="expressArea" href="javascript:void(0)" class="f24 form-group box-flex">
                            <label class="form-label">选择地区：</label>
                            <empty name="address">
                                <div class="area_address">省 &gt; 市 &gt; 区/县</div>
                                <else />
                                <div class="area_address"></div>
                            </empty>

                        </a>
                    </div>
                    <div class="form-group box-flex">
                        <label class="form-label">详细地址：</label>
                        <input type="text" name="address" class="input-flex recipient_detail_address" placeholder="请填写详细地址" value="">
                    </div>
                </form>
            </section>
            <!--选择地区弹层-->
            <section id="areaLayer" class="express-area-box" style="display:none;">
                <header>
                    <h3>选择地区</h3>
                    <a id="backUp" class="back" href="javascript:void(0)" title="返回" style="display: none;"></a>
                    <a id="closeArea" class="close" href="javascript:void(0)" title="关闭"></a>
                </header>
                <article id="areaBox">
                    <ul id="areaList" class="area-list">
                        <!--<li onclick="selectP(0);">北京市</li><li onclick="selectP(1);">天津市</li><li onclick="selectP(2);">河北省</li><li onclick="selectP(3);">河南省</li><li onclick="selectP(4);">山西省</li><li onclick="selectP(5);">山东省</li><li onclick="selectP(6);">内蒙古自治区</li><li onclick="selectP(7);">辽宁省</li><li onclick="selectP(8);">吉林省</li><li onclick="selectP(9);">黑龙江省</li><li onclick="selectP(10);">上海市</li><li onclick="selectP(11);">江苏省</li><li onclick="selectP(12);">浙江省</li><li onclick="selectP(13);">福建省</li><li onclick="selectP(14);">江西省</li><li onclick="selectP(15);">安徽省</li><li onclick="selectP(16);">湖北省</li><li onclick="selectP(17);">湖南省</li><li onclick="selectP(18);">广东省</li><li onclick="selectP(19);">广西壮族自治区</li><li onclick="selectP(20);">海南省</li><li onclick="selectP(21);">重庆市</li><li onclick="selectP(22);">四川省</li><li onclick="selectP(23);">贵州省</li><li onclick="selectP(24);">云南省</li><li onclick="selectP(25);">西藏自治区</li><li onclick="selectP(26);">陕西省</li><li onclick="selectP(27);">甘肃省</li><li onclick="selectP(28);">青海省</li><li onclick="selectP(29);">宁夏回族自治区</li><li onclick="selectP(30);">新疆维吾尔自治区</li><li onclick="selectP(31);">台湾省</li><li onclick="selectP(32);">香港特别行政区</li><li onclick="selectP(33);">澳门特别行政区</li>-->
                    </ul>
                </article>
            </section>
            <!--遮罩层-->
            <div id="areaMask" class="mask address_mask"></div>
        </notempty>
          <!--发票抬头-->
        <section class="goods_order_form">
            <!--结算显示商品页面-->
            <notempty name="cartList">
            <ul class="goods_order_item">
                <input type="hidden" id="cartIds" value="{$cartIds}">
                <volist name="cartList" id="vo">
                <li>
                    <notempty name="vo.img">
                        <img data-img="" data-isloaded="" src="__ROOT__/Uploads/{$vo.img}" alt="" class="c_img" />
                        <else />
                        <img data-img="" data-isloaded="" src="PUBLIC_IMG/home/default/goods_default.png" alt="" class="c_img" />
                    </notempty>
                    <div class="g_order_r">
                        <p>{$vo.foreign_name}</p>
                        <div class="goods_price_num">
                            <div class="cost_price"><span>￥</span>{$vo.price}</div>
                            <div class="quantity_wrapper">
                                <a href="javascript:void(0);" class="reduce">-</a>
                                <input type="text" value="{$vo.num}" class="f24 shopping_count">
                                <input type="hidden" value="{$vo.foreign_id}" class="goodsId">
                                <a href="javascript:void(0);" class="plus">+</a>
                            </div>
                        </div>
                    </div>
                </li>
                </volist>
            </ul>
            </notempty>
            <!--立即购买显示商品页面-->
            <notempty name="goodsInfo">
            <ul class="goods_order_item">
                    <li>
                        <notempty name="vo.img">
                            <img data-img="" data-isloaded="" src="UPLOADS_IMG/{$goodsInfo.main_img}" alt="" class="c_img" />
                            <else />
                            <img data-img="" data-isloaded="" src="PUBLIC_IMG/home/default/goods_default.png" alt="" class="c_img" />
                        </notempty>
                        <div class="g_order_r">
                            <p>{$goodsInfo.name}</p>
                            <div class="goods_price_num">
                                <div class="cost_price"><span>￥</span>{$goodsInfo.real_price}</div>
                                <div class="quantity_wrapper">
                                    <a href="javascript:void(0);" class="reduce">-</a>
                                    <input type="text" value="{$num}" class="f24 shopping_count">
                                    <input type="hidden" value="{$goodsInfo.id}" id="goodsId" class="goodsId">
                                    <input type="hidden" value="{$groupBuySn}"  class="groupBuySn">
                                    <a href="javascript:void(0);" class="plus">+</a>
                                </div>
                            </div>
                        </div>
                    </li>
            </ul>
            </notempty>

            <!--立即购买显示项目页面-->
            <notempty name="projectInfo">
                <ul class="goods_order_item">
                    <li>
                        <notempty name="vo.img">
                            <img data-img="" data-isloaded="" src="UPLOADS_IMG/{$projectInfo.main_img}" alt="" class="c_img" />
                            <else />
                            <img data-img="" data-isloaded="" src="PUBLIC_IMG/home/default/goods_default.png" alt="" class="c_img" />
                        </notempty>
                        <div class="g_order_r">
                            <p>{$projectInfo.name}</p>
                            <div class="goods_price_num">
                                <div class="cost_price"><span>￥</span>{$projectInfo.real_price}</div>
                                <div class="quantity_wrapper">
                                    <a href="javascript:void(0);" class="reduce">-</a>
                                    <input type="text" value="{$num}" class="f24 shopping_count">
                                    <input type="hidden" value="{$projectInfo.id}" id="projectId" class="projectId">
                                    <input type="hidden" value="{$groupBuySn}"  class="groupBuySn">
                                    <a href="javascript:void(0);" class="plus">+</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </notempty>
        </section>
    </article>
</block>
<block name="footer">
    <include file="Cart/footerCartMenu" />
</block>
<block name="js-customize">
    <script src="PUBLIC_JS/common/jquery.area.js"></script>
</block>
<block name="script">
    <script type="text/javascript">
        $(function(){
            $('.shopping_count').on('input propertychange',function(){
                if(!$(this).val()){
                    return false;
                }
                TotalPrice();
            });

            //商品数量加减
            $.each($('.goods_order_item li'),function(){
                var _this=$(this);
                var shopNum=_this.find('.shopping_count').val();
                _this.find('.plus').on('click',function(){
                    shopNum=_this.find('.shopping_count').val();
                    shopNum++;
                    $(this).siblings('.shopping_count').val(shopNum);
                    TotalPrice();

                });
                _this.find('.reduce').on('click',function(){

                    shopNum=_this.find('.shopping_count').val();

                    if(shopNum<2){
                        return false;
                    }
                    shopNum--;
                    $(this).siblings('.shopping_count').val(shopNum);
                    TotalPrice();
                })
            });
            function TotalPrice(){
                var allPrice=0;
                $.each($('.goods_order_item li'),function(){
                    var _this=$(this);
                    var goodsNum=parseInt(_this.find('.shopping_count').val());
                    var goodsPrice=_this.find('.cost_price').text().replace(/[^\d.]/g,"");
                    var total=goodsNum*goodsPrice;
                    allPrice +=total;
                });
                $('.price_items_all i').text(allPrice);
            }

            //跳转到地址列表，更换地址
            $('body').on('click','.changeAddress',function () {
                var cartIds = $('#cartIds').val();
                var goodsId = $('#goodsId').val();
                var projectId = $('#projectId').val();
                var url = MODULE + '/Address/addressList';
                if(cartIds){
                    url += '/cartIds/'+cartIds;
                }
                if(goodsId){
                    url += '/goodsId/'+goodsId;
                }
                if(projectId){
                    url += '/projectId/'+projectId;
                }
                location.href = url;
            });

        })
    </script>
</block>